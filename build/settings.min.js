!function(e){function t(r){if(n[r])return n[r].exports;var u=n[r]={exports:{},id:r,loaded:!1};return e[r].call(u.exports,u,u.exports,t),u.loaded=!0,u.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}({0:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e){return e.reduce(function(e,t){return t.checked?t.value:e},null)}function o(e,t){e.forEach(function(e){return e.checked=e.value==t})}var i=n(58),a=r(i),s=n(20),l=r(s),c=n(21),d=r(c),f=n(6),h=r(f),v=n(18),m=r(v),p=location.pathname.match(/BetterFeed2\/([^\/]+)/);p&&document.querySelector(".version").appendChild(document.createTextNode(p[1])),(0,h["default"])(document.body,".local-link",function(e){return e.href+=location.search});var y=document.querySelector(".content.settings");y&&!function(){var e=window.parent===window?window.opener:window.parent;e&&/[?&]origin=([^&]+)/.exec(location.search)||alert("Пожалуйста, откройте эту страницу по ссылке из FreeFeed-а");var t=decodeURIComponent(/[?&]origin=([^&]+)/.exec(location.search)[1]),n=document.getElementById("save-settings"),r=document.getElementById("check-updates"),i=(0,h["default"])(y,"input[type='checkbox']"),s=document.getElementById("hide-posts-from-users"),c=(0,h["default"])(y,"input[name='comment-clouds-mode']"),f=new d["default"](e,t),v=null;n.addEventListener("click",function(){n.disabled=!0,n.style.width=n.offsetWidth+"px",n.innerHTML=(0,m["default"])("Сохраняем…"),i.forEach(function(e){return v.modules.set(e.id,e.checked)}),v.hidePostsFrom.clear(),(s.value.toLowerCase().match(/\w+/g)||[]).forEach(function(e){return v.hidePostsFrom.add(e)}),v.commentCloudsMode=parseInt(u(c)),f.send("saveSettings",v.toJSON())}),r.addEventListener("click",function(e){var t=e.target;t.disabled=!0,f.send("checkUpdates").then(function(){return t.disabled=!1})});var p=new a["default"](!1),b=new Map,g=function(){var e=new Map;return(0,h["default"])(y,"input, textarea",function(t){t.id&&e.set(t.id,"checkbox"===t.type?t.checked:t.value)}),e.set("comment-clouds-mode",u(c)),e},_=function(){i.forEach(function(e){return e.checked=v.modules.get(e.id)});var e="";v.hidePostsFrom.forEach(function(t){return e+=", "+t}),s.value=e.substr(2),o(c,v.commentCloudsMode)};f.send("getSettings").then(function(e){v=new l["default"](e,!0),_(),(0,h["default"])(y,"[data-disabled-if]",function(e){var t=e.dataset.disabledIf,n=document.getElementById(t);n&&a["default"].fromInput(n).onValue(function(t){return e.disabled=t})}),(0,h["default"])(y,"[data-enabled-if]",function(e){var t=e.dataset.enabledIf,n=document.getElementById(t);n&&a["default"].fromInput(n).onValue(function(t){return e.disabled=!t})}),b=g(),y.classList.remove("hidden"),y.previousElementSibling.classList.add("hidden")});var w=function(){var e=g(),t=!1;e.forEach(function(e,n){return t=t||e!==b.get(n)}),p.value=t};y.addEventListener("input",w),y.addEventListener("change",w),p.distinct().onValue(function(e){return n.disabled=!e})}()},5:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){var t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],n=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],r=new d(e,t,n);return c.set(e,r),r}function i(e){if(!f){f=e,c.forEach(function(e){f.isModuleEnabled(e)&&e._initiate(f)});var t=new MutationObserver(function(e){e.forEach(function(e){for(var t=function(t,n){var r=e.addedNodes[t];r.nodeType==Node.ELEMENT_NODE&&c.forEach(function(e){f.isModuleEnabled(e)&&e._trigger(r,f)})},n=0,r=e.addedNodes.length;r>n;n++)t(n,r)})});t.observe(document.body,{childList:!0,subtree:!0})}}Object.defineProperty(t,"__esModule",{value:!0}),t.registeredModules=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.registerModule=o,t.startObserver=i;var s=n(6),l=r(s),c=t.registeredModules=new Map,d=function(){function e(t){var n=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],r=arguments.length<=2||void 0===arguments[2]?!1:arguments[2];u(this,e),this.name=t,this.alwaysEnabled=r,this.enabledByDefault=n,this.requiredModules=[],this.active=!0,this._watchers=[],this._initiators=[]}return a(e,[{key:"init",value:function(e){this._initiators.push(e)}},{key:"watch",value:function(e,t){this._watchers.push({selector:e,callback:t})}},{key:"required",value:function(e){this.requiredModules.push(e)}},{key:"_initiate",value:function(e){this.active&&(this._initiators.forEach(function(t){return t(e)}),this._watchers.forEach(function(t){var n=t.selector,r=t.callback;return(0,l["default"])(document.body,n,function(t){return r(t,e)})}))}},{key:"_trigger",value:function(e){this.active&&this._watchers.forEach(function(t){var n=t.selector,r=t.callback;return(0,l["default"])(e,n,function(e){return r(e,f)})})}}]),e}(),f=null},6:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var u=n(7),o=r(u);t["default"]=function(e,t,n){if(null===e)return[];var r=e.querySelectorAll(t),u=r?Array.prototype.slice.call(r):[];if((0,o["default"])(e,t)&&u.unshift(e),n)for(var i=0,a=u.length;a>i;i++)n(u[i]);return u}},7:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e,t){return e[n](t)};var n="matches"in HTMLElement.prototype?"matches":"msMatchesSelector"},18:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")}},20:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){var n=[],r=!0,u=!1,o=void 0;try{for(var i,a=e[Symbol.iterator]();!(r=(i=a.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(s){u=!0,o=s}finally{try{!r&&a["return"]&&a["return"]()}finally{if(u)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(5),a=function(){function e(){var t=this,n=arguments.length<=0||void 0===arguments[0]?null:arguments[0],o=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];r(this,e),this.modules=new Map,i.registeredModules.forEach(function(e){e.alwaysEnabled||t.modules.set(e.name,e.enabledByDefault)}),this.hidePostsFrom=new Set,this.hideAliens=!1,this.commentCloudsMode=2,n&&((n.modules||[]).forEach(function(e){var n=u(e,2),r=n[0],i=n[1];(o||t.modules.has(r))&&t.modules.set(r,!!i)}),(n.hidePostsFrom||[]).forEach(function(e){return t.hidePostsFrom.add(e)}),this.hideAliens=!!n.hideAliens,1!==n.commentCloudsMode&&2!==n.commentCloudsMode||(this.commentCloudsMode=n.commentCloudsMode))}return o(e,[{key:"toJSON",value:function(){var e={modules:[],hidePostsFrom:[]};return this.modules.forEach(function(t,n){return e.modules.push([n,t])}),this.hidePostsFrom.forEach(function(t){return e.hidePostsFrom.push(t)}),e.hideAliens=this.hideAliens,e.commentCloudsMode=this.commentCloudsMode,e}},{key:"isModuleEnabled",value:function(e){var t=this;return(e.alwaysEnabled||!this.modules.has(e.name)&&e.enabledByDefault||this.modules.get(e.name))&&!e.requiredModules.map(function(e){return i.registeredModules.get(e)}).some(function(e){return!t.isModuleEnabled(e)})}}]),e}();t["default"]=a},21:function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=1,i="@response",a=function(){function e(){var t=this,u=arguments.length<=0||void 0===arguments[0]?null:arguments[0],o=arguments.length<=1||void 0===arguments[1]?"":arguments[1];n(this,e),this.__responders=new Map,this.__listeners=new Map,this.defaultWindow=u,this.defaultOrigin=o,window.addEventListener("message",function(e){if("object"===r(e.data)){var n=e.data,u=n.action,o=n.requestId,a=n.value,s=e.source,l=e.origin;if(u===i&&t.__responders.has(o))t.__responders.get(o)(a),t.__responders["delete"](o);else if(t.__listeners.has(u)){var c=t.__listeners.get(u)(a);s.postMessage({action:i,requestId:o,value:c},l)}}})}return u(e,[{key:"send",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return this.sendEx(this.defaultWindow,this.defaultOrigin,e,t)}},{key:"sendEx",value:function(e,t,n){var r=this,u=arguments.length<=3||void 0===arguments[3]?null:arguments[3];return new Promise(function(i){var a=o++;r.__responders.set(a,i),e.postMessage({action:n,requestId:a,value:u},t)})}},{key:"on",value:function(e,t){this.__listeners.set(e,t)}}]),e}();t["default"]=a},58:function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(){function e(t){n(this,e),this._value=t,this._listeners=new Set}return r(e,[{key:"poke",value:function(){var e=this;this._listeners.forEach(function(t){return t(e._value)})}},{key:"onValue",value:function(e){return this._listeners.add(e),e(this.value),this}},{key:"unListen",value:function(e){return this._listeners["delete"](e),this}},{key:"derive",value:function(t,n){var r=new e(n);return this.onValue(function(e){return t(r,e)}),r}},{key:"map",value:function(e){return this.derive(function(t,n){return t.value=e(n)})}},{key:"filter",value:function(e){return this.derive(function(t,n){return e(n)&&(t.value=n)})}},{key:"throttle",value:function(e){var t=this,n=void 0,r=null;return this.derive(function(u,o){n=o,r||(r=setTimeout(function(){void 0!==n&&(u.value=t.value,n=void 0),r=null},e))},this.value)}},{key:"latestPromise",value:function(e){var t=null;return this.derive(function(e,n){var r=n;t=r,r.then(function(n){r===t&&(e.value=n)})},e)}},{key:"distinct",value:function(){var e;return this.derive(function(t,n){n!==e&&(e=n,t.value=n)})}},{key:"value",get:function(){return this._value},set:function(e){this._value=e,this.poke()}}],[{key:"combine",value:function(){for(var t=arguments.length,n=Array(t),r=0;t>r;r++)n[r]=arguments[r];var u=new e(n.map(function(e){return e.value}));return n.forEach(function(e,t){return e.onValue(function(e){var n=u.value;n[t]=e,u.value=n})}),u}},{key:"fromInput",value:function(t,n,r){if(!t||!(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement||t instanceof HTMLSelectElement))return new e(null);var u="value";t instanceof HTMLInputElement&&("checkbox"===t.type||"radio"===t.type)&&(u="checked");var o=n?n.split(" "):["input","change"];r=r||u;var i=function(){return"self"===r?t:t[r]},a=new e(i());return o.forEach(function(e){return t.addEventListener(e,function(){return a.value=i()})}),a}},{key:"ticker",value:function t(n){var t=new e(!0);return setInterval(function(){return t.value=!0},n),t}}]),e}();t["default"]=u}});
//# sourceMappingURL=settings.min.js.map