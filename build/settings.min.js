!function(e){function t(r){if(n[r])return n[r].exports;var u=n[r]={exports:{},id:r,loaded:!1};return e[r].call(u.exports,u,u.exports,t),u.loaded=!0,u.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}({0:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var u=n(38),i=r(u),o=n(18),a=r(o),l=n(19),s=r(l),c=n(6),d=r(c),f=n(16),h=r(f),v=location.pathname.match(/BetterFeed2\/([^\/]+)/);v&&document.querySelector(".version").appendChild(document.createTextNode(v[1])),(0,d["default"])(document.body,".local-link",function(e){return e.href+=location.search});var p=document.querySelector(".content.settings");p&&!function(){var e=window.parent===window?window.opener:window.parent;e&&/[?&]origin=([^&]+)/.exec(location.search)||alert("Пожалуйста, откройте эту страницу по ссылке из FreeFeed-а");var t=decodeURIComponent(/[?&]origin=([^&]+)/.exec(location.search)[1]),n=document.getElementById("save-settings"),r=document.getElementById("check-updates"),u=(0,d["default"])(p,"input[type='checkbox']"),o=document.getElementById("hide-posts-from-users"),l=new s["default"](e,t),c=null;n.addEventListener("click",function(){n.disabled=!0,n.style.width=n.offsetWidth+"px",n.innerHTML=(0,h["default"])("Сохраняем…"),u.forEach(function(e){return c.modules.set(e.id,e.checked)}),c.hidePostsFrom.clear(),(o.value.toLowerCase().match(/\w+/g)||[]).forEach(function(e){return c.hidePostsFrom.add(e)}),l.send("saveSettings",c.toJSON())}),r.addEventListener("click",function(e){var t=e.target;t.disabled=!0,l.send("checkUpdates").then(function(){return t.disabled=!1})});var f=new i["default"](!1),v=new Map,y=function(){var e=new Map;return(0,d["default"])(p,"input, textarea",function(t){e.set(t.id,"checkbox"===t.type?t.checked:t.value)}),e},m=function(){u.forEach(function(e){return e.checked=c.modules.get(e.id)});var e="";c.hidePostsFrom.forEach(function(t){return e+=", "+t}),o.value=e.substr(2)};l.send("getSettings").then(function(e){c=new a["default"](e,!0),m(),(0,d["default"])(p,"[data-disabled-if]",function(e){var t=e.dataset.disabledIf,n=document.getElementById(t);n&&i["default"].fromInput(n).onValue(function(t){return e.disabled=t})}),(0,d["default"])(p,"[data-enabled-if]",function(e){var t=e.dataset.enabledIf,n=document.getElementById(t);n&&i["default"].fromInput(n).onValue(function(t){return e.disabled=!t})}),v=y(),p.classList.remove("hidden"),p.previousElementSibling.classList.add("hidden")});var b=function(){var e=y(),t=!1;e.forEach(function(e,n){return t=t||e!==v.get(n)}),f.value=t};p.addEventListener("input",b),p.addEventListener("change",b),f.distinct().onValue(function(e){return n.disabled=!e})}()},5:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e){var t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],n=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],r=new d(e,t,n);return c.set(e,r),r}function o(e){if(!f){f=e,c.forEach(function(e){f.isModuleEnabled(e)&&e._initiate(f)});var t=new MutationObserver(function(e){e.forEach(function(e){for(var t=function(t,n){var r=e.addedNodes[t];r.nodeType==Node.ELEMENT_NODE&&c.forEach(function(e){f.isModuleEnabled(e)&&e._trigger(r,f)})},n=0,r=e.addedNodes.length;r>n;n++)t(n,r)})});t.observe(document.body,{childList:!0,subtree:!0})}}Object.defineProperty(t,"__esModule",{value:!0}),t.registeredModules=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.registerModule=i,t.startObserver=o;var l=n(6),s=r(l),c=t.registeredModules=new Map,d=function(){function e(t){var n=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],r=arguments.length<=2||void 0===arguments[2]?!1:arguments[2];u(this,e),this.name=t,this.alwaysEnabled=r,this.enabledByDefault=n,this.requiredModules=[],this._watchers=[],this._initiators=[]}return a(e,[{key:"init",value:function(e){this._initiators.push(e)}},{key:"watch",value:function(e,t){this._watchers.push({selector:e,callback:t})}},{key:"required",value:function(e){this.requiredModules.push(e)}},{key:"_initiate",value:function(e){this._initiators.forEach(function(t){return t(e)}),this._watchers.forEach(function(t){var n=t.selector,r=t.callback;return(0,s["default"])(document.body,n,function(t){return r(t,e)})})}},{key:"_trigger",value:function(e){this._watchers.forEach(function(t){var n=t.selector,r=t.callback;return(0,s["default"])(e,n,function(e){return r(e,f)})})}}]),e}(),f=null},6:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var u=n(7),i=r(u);t["default"]=function(e,t,n){if(null===e)return[];var r=e.querySelectorAll(t),u=r?Array.prototype.slice.call(r):[];if((0,i["default"])(e,t)&&u.unshift(e),n)for(var o=0,a=u.length;a>o;o++)n(u[o]);return u}},7:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e,t){return e[n](t)};var n="matches"in HTMLElement.prototype?"matches":"msMatchesSelector"},16:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")}},18:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){var n=[],r=!0,u=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(l){u=!0,i=l}finally{try{!r&&a["return"]&&a["return"]()}finally{if(u)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(5),a=function(){function e(){var t=this,n=arguments.length<=0||void 0===arguments[0]?null:arguments[0],i=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];r(this,e),this.modules=new Map,o.registeredModules.forEach(function(e){e.alwaysEnabled||t.modules.set(e.name,e.enabledByDefault)}),this.hidePostsFrom=new Set,this.hideAliens=!1,n&&((n.modules||[]).forEach(function(e){var n=u(e,2),r=n[0],o=n[1];(i||t.modules.has(r))&&t.modules.set(r,!!o)}),(n.hidePostsFrom||[]).forEach(function(e){return t.hidePostsFrom.add(e)}),this.hideAliens=!!n.hideAliens)}return i(e,[{key:"toJSON",value:function(){var e={modules:[],hidePostsFrom:[]};return this.modules.forEach(function(t,n){return e.modules.push([n,t])}),this.hidePostsFrom.forEach(function(t){return e.hidePostsFrom.push(t)}),e.hideAliens=this.hideAliens,e}},{key:"isModuleEnabled",value:function(e){var t=this;return(e.alwaysEnabled||!this.modules.has(e.name)&&e.enabledByDefault||this.modules.get(e.name))&&!e.requiredModules.map(function(e){return o.registeredModules.get(e)}).some(function(e){return!t.isModuleEnabled(e)})}}]),e}();t["default"]=a},19:function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=1,o="@response",a=function(){function e(){var t=this,u=arguments.length<=0||void 0===arguments[0]?null:arguments[0],i=arguments.length<=1||void 0===arguments[1]?"":arguments[1];n(this,e),this.__responders=new Map,this.__listeners=new Map,this.defaultWindow=u,this.defaultOrigin=i,window.addEventListener("message",function(e){if("object"===r(e.data)){var n=e.data,u=n.action,i=n.requestId,a=n.value,l=e.source,s=e.origin;if(u===o&&t.__responders.has(i))t.__responders.get(i)(a),t.__responders["delete"](i);else if(t.__listeners.has(u)){var c=t.__listeners.get(u)(a);l.postMessage({action:o,requestId:i,value:c},s)}}})}return u(e,[{key:"send",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return this.sendEx(this.defaultWindow,this.defaultOrigin,e,t)}},{key:"sendEx",value:function(e,t,n){var r=this,u=arguments.length<=3||void 0===arguments[3]?null:arguments[3];return new Promise(function(o){var a=i++;r.__responders.set(a,o),e.postMessage({action:n,requestId:a,value:u},t)})}},{key:"on",value:function(e,t){this.__listeners.set(e,t)}}]),e}();t["default"]=a},38:function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(){function e(t){n(this,e),this._value=t,this._listeners=new Set}return r(e,[{key:"poke",value:function(){var e=this;this._listeners.forEach(function(t){return t(e._value)})}},{key:"onValue",value:function(e){return this._listeners.add(e),e(this.value),this}},{key:"unListen",value:function(e){return this._listeners["delete"](e),this}},{key:"derive",value:function(t,n){var r=new e(n);return this.onValue(function(e){return t(r,e)}),r}},{key:"map",value:function(e){return this.derive(function(t,n){return t.value=e(n)})}},{key:"filter",value:function(e){return this.derive(function(t,n){return e(n)&&(t.value=n)})}},{key:"throttle",value:function(e){var t=this,n=void 0,r=null;return this.derive(function(u,i){n=i,r||(r=setTimeout(function(){void 0!==n&&(u.value=t.value,n=void 0),r=null},e))},this.value)}},{key:"latestPromise",value:function(e){var t=null;return this.derive(function(e,n){var r=n;t=r,r.then(function(n){r===t&&(e.value=n)})},e)}},{key:"distinct",value:function(){var e;return this.derive(function(t,n){n!==e&&(e=n,t.value=n)})}},{key:"value",get:function(){return this._value},set:function(e){this._value=e,this.poke()}}],[{key:"combine",value:function(){for(var t=arguments.length,n=Array(t),r=0;t>r;r++)n[r]=arguments[r];var u=new e(n.map(function(e){return e.value}));return n.forEach(function(e,t){return e.onValue(function(e){var n=u.value;n[t]=e,u.value=n})}),u}},{key:"fromInput",value:function(t,n,r){if(!t||!(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement||t instanceof HTMLSelectElement))return new e(null);var u="value";t instanceof HTMLInputElement&&("checkbox"===t.type||"radio"===t.type)&&(u="checked");var i=n?n.split(" "):["input","change"];r=r||u;var o=function(){return"self"===r?t:t[r]},a=new e(o());return i.forEach(function(e){return t.addEventListener(e,function(){return a.value=o()})}),a}},{key:"ticker",value:function t(n){var t=new e(!0);return setInterval(function(){return t.value=!0},n),t}}]),e}();t["default"]=u}});
//# sourceMappingURL=settings.min.js.map