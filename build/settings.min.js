!function(e){function t(r){if(n[r])return n[r].exports;var u=n[r]={exports:{},id:r,loaded:!1};return e[r].call(u.exports,u,u.exports,t),u.loaded=!0,u.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}({0:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function u(e){return e.reduce(function(e,t){return t.checked?t.value:e},null)}function i(e,t){e.forEach(function(e){return e.checked=e.value==t})}var o=n(42),a=r(o),l=n(20),s=r(l),c=n(21),d=r(c),f=n(7),v=r(f),h=n(18),m=r(h),p=document.querySelector(".content.settings");if(p){var y=window.parent===window?window.opener:window.parent;y||alert("Пожалуйста, откройте эту страницу по ссылке из FreeFeed-а");var b=document.querySelector('meta[name="parentOrigin"]').content,g=document.querySelector('meta[name="betterFeedVersion"]').content,_=document.getElementById("save-settings"),w=document.getElementById("check-updates"),E=(0,v.default)(p,"input[type='checkbox']"),M=(0,v.default)(p,"input[name='comment-clouds-mode']"),k=new d.default(y,b),O=null;document.querySelector(".version").appendChild(document.createTextNode(g)),_.addEventListener("click",function(){_.disabled=!0,_.style.width=_.offsetWidth+"px",_.innerHTML=(0,m.default)("Сохраняем…"),E.forEach(function(e){return O.modules.set(e.id,e.checked)}),O.commentCloudsMode=parseInt(u(M)),k.send("saveSettings",O.toJSON())}),w.addEventListener("click",function(e){var t=e.target;t.disabled=!0,k.send("checkUpdates").then(function(){return t.disabled=!1})});var S=new a.default(!1),I=new Map,L=function(){var e=new Map;return(0,v.default)(p,"input, textarea",function(t){t.id&&e.set(t.id,"checkbox"===t.type?t.checked:t.value)}),e.set("comment-clouds-mode",u(M)),e},x=function(){E.forEach(function(e){return e.checked=O.modules.get(e.id)}),i(M,O.commentCloudsMode)};k.send("getSettings").then(function(e){O=new s.default(e,!0),x(),(0,v.default)(p,"[data-disabled-if]",function(e){var t=e.dataset.disabledIf,n=document.getElementById(t);n&&a.default.fromInput(n).onValue(function(t){return e.disabled=t})}),(0,v.default)(p,"[data-enabled-if]",function(e){var t=e.dataset.enabledIf,n=document.getElementById(t);n&&a.default.fromInput(n).onValue(function(t){return e.disabled=!t})}),I=L(),p.classList.remove("hidden"),p.previousElementSibling.classList.add("hidden")});var T=function(){var e=L(),t=!1;e.forEach(function(e,n){return t=t||e!==I.get(n)}),S.value=t};p.addEventListener("input",T),p.addEventListener("change",T),S.distinct().onValue(function(e){return _.disabled=!e})}},6:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=new d(e,t,n);return c.set(e,r),r}function o(e){if(!f){f=e,c.forEach(function(e){f.isModuleEnabled(e)&&e._initiate(f)});var t=new MutationObserver(function(e){e.forEach(function(e){for(var t=function(t,n){var r=e.addedNodes[t];r.nodeType==Node.ELEMENT_NODE&&c.forEach(function(e){f.isModuleEnabled(e)&&e._trigger(r,f)})},n=0,r=e.addedNodes.length;n<r;n++)t(n,r)})});t.observe(document.body,{childList:!0,subtree:!0})}}Object.defineProperty(t,"__esModule",{value:!0}),t.registeredModules=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.registerModule=i,t.startObserver=o;var l=n(7),s=r(l),c=t.registeredModules=new Map,d=function(){function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];u(this,e),this.name=t,this.alwaysEnabled=r,this.enabledByDefault=n,this.requiredModules=[],this.active=!0,this._watchers=[],this._initiators=[]}return a(e,[{key:"init",value:function(e){this._initiators.push(e)}},{key:"watch",value:function(e,t){this._watchers.push({selector:e,callback:t})}},{key:"required",value:function(e){this.requiredModules.push(e)}},{key:"_initiate",value:function(e){this.active&&(this._initiators.forEach(function(t){return t(e)}),this._watchers.forEach(function(t){var n=t.selector,r=t.callback;return(0,s.default)(document.body,n,function(t){return r(t,e)})}))}},{key:"_trigger",value:function(e){this.active&&this._watchers.forEach(function(t){var n=t.selector,r=t.callback;return(0,s.default)(e,n,function(e){return r(e,f)})})}}]),e}(),f=null},7:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var u=n(8),i=r(u);t.default=function(e,t,n){if(null===e)return[];var r=e.querySelectorAll(t),u=r?Array.prototype.slice.call(r):[];if((0,i.default)(e,t)&&u.unshift(e),n)for(var o=0,a=u.length;o<a;o++)n(u[o]);return u}},8:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return e[n](t)};var n="matches"in HTMLElement.prototype?"matches":"msMatchesSelector"},18:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")}},20:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){var n=[],r=!0,u=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){u=!0,i=e}finally{try{!r&&a.return&&a.return()}finally{if(u)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(6),a=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];r(this,e),this.modules=new Map,o.registeredModules.forEach(function(e){e.alwaysEnabled||t.modules.set(e.name,e.enabledByDefault)}),this.hideAliens=!1,this.commentCloudsMode=2,n&&((n.modules||[]).forEach(function(e){var n=u(e,2),r=n[0],o=n[1];(i||t.modules.has(r))&&t.modules.set(r,!!o)}),this.hideAliens=!!n.hideAliens,1!==n.commentCloudsMode&&2!==n.commentCloudsMode||(this.commentCloudsMode=n.commentCloudsMode))}return i(e,[{key:"toJSON",value:function(){var e={modules:[]};return this.modules.forEach(function(t,n){return e.modules.push([n,t])}),e.hideAliens=this.hideAliens,e.commentCloudsMode=this.commentCloudsMode,e}},{key:"isModuleEnabled",value:function(e){var t=this;return e&&(e.alwaysEnabled||!this.modules.has(e.name)&&e.enabledByDefault||this.modules.get(e.name))&&!e.requiredModules.map(function(e){return o.registeredModules.get(e)}).some(function(e){return!t.isModuleEnabled(e)})}}]),e}();t.default=a},21:function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=1,o="@response",a=function(){function e(){var t=this,u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";n(this,e),this.__responders=new Map,this.__listeners=new Map,this.defaultWindow=u,this.defaultOrigin=i,window.addEventListener("message",function(e){if("object"===r(e.data)){var n=e.data,u=n.action,i=n.requestId,a=n.value,l=e.source,s=e.origin;if(u===o&&t.__responders.has(i))t.__responders.get(i)(a),t.__responders.delete(i);else if(t.__listeners.has(u)){var c=t.__listeners.get(u)(a);l.postMessage({action:o,requestId:i,value:c},s)}}})}return u(e,[{key:"send",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sendEx(this.defaultWindow,this.defaultOrigin,e,t)}},{key:"sendEx",value:function(e,t,n){var r=this,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return new Promise(function(o){var a=i++;r.__responders.set(a,o),e.postMessage({action:n,requestId:a,value:u},t)})}},{key:"on",value:function(e,t){this.__listeners.set(e,t)}}]),e}();t.default=a},42:function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(){function e(t){n(this,e),this._value=t,this._listeners=new Set}return r(e,[{key:"poke",value:function(){var e=this;this._listeners.forEach(function(t){return t(e._value)})}},{key:"onValue",value:function(e){return this._listeners.add(e),e(this.value),this}},{key:"unListen",value:function(e){return this._listeners.delete(e),this}},{key:"derive",value:function(t,n){var r=new e(n);return this.onValue(function(e){return t(r,e)}),r}},{key:"map",value:function(e){return this.derive(function(t,n){return t.value=e(n)})}},{key:"filter",value:function(e){return this.derive(function(t,n){return e(n)&&(t.value=n)})}},{key:"throttle",value:function(e){var t=this,n=void 0,r=null;return this.derive(function(u,i){n=i,r||(r=setTimeout(function(){void 0!==n&&(u.value=t.value,n=void 0),r=null},e))},this.value)}},{key:"latestPromise",value:function(e){var t=null;return this.derive(function(e,n){var r=n;t=r,r.then(function(n){r===t&&(e.value=n)})},e)}},{key:"distinct",value:function(){var e;return this.derive(function(t,n){n!==e&&(e=n,t.value=n)})}},{key:"value",get:function(){return this._value},set:function(e){this._value=e,this.poke()}}],[{key:"combine",value:function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var u=new e(n.map(function(e){return e.value}));return n.forEach(function(e,t){return e.onValue(function(e){var n=u.value;n[t]=e,u.value=n})}),u}},{key:"fromInput",value:function(t,n,r){if(!t||!(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement||t instanceof HTMLSelectElement))return new e(null);var u="value";t instanceof HTMLInputElement&&("checkbox"===t.type||"radio"===t.type)&&(u="checked");var i=n?n.split(" "):["input","change"];r=r||u;var o=function(){return"self"===r?t:t[r]},a=new e(o());return i.forEach(function(e){return t.addEventListener(e,function(){return a.value=o()})}),a}},{key:"ticker",value:function t(n){var t=new e(!0);return setInterval(function(){return t.value=!0},n),t}}]),e}();t.default=u}});
//# sourceMappingURL=settings.min.js.map