(function(){"use strict";function de(t,e){e===void 0&&(e={});var n=e.insertAt;if(!(!t||typeof document>"u")){var o=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",n==="top"&&o.firstChild?o.insertBefore(s,o.firstChild):o.appendChild(s),s.styleSheet?s.styleSheet.cssText=t:s.appendChild(document.createTextNode(t))}}const ue=`.bf2-lightbox-container{left:0;top:0;width:100%;height:100%;position:fixed;z-index:10}.bf2-lightbox-shadow{left:0;top:0;width:100%;height:100%;position:absolute;display:flex;align-items:center;justify-content:center;background-color:#00000080}.bf2-lightbox-content{position:relative;border:1px solid #000;background-color:#ccc;box-shadow:0 0 50px #00000080}.bf2-settings-lightbox .bf2-lightbox-content{width:90vw;height:90vh;max-width:800px}.bf2-settings-lightbox .bf2-lightbox-content iframe{left:0;top:0;width:100%;height:100%}.bf2-access-token-lightbox .bf2-lightbox-content{background-color:#fff;max-width:90vw;padding:2em}.bf2-access-token-lightbox .bf2-lightbox-content button{padding:.25em 2em;cursor:pointer}.bf2-access-token-lightbox .bf2-lightbox-content .bf2-access-token{word-wrap:break-word;font-family:monospace;color:#069;background-color:#eee;padding:1em}.bf2-green{padding:1em}.bf2-via-names{font-size:12px}.bf2-hide-aliens-cont{font-size:14px;font-weight:400;margin-left:1em;display:none}.bf2-homepage .bf2-hide-aliens-cont{display:inline}.bf2-hide-aliens .bf2-alien-post{display:none}.bf2-saving-settings-indicator{position:fixed;top:.66em;right:1em;background:#f66;color:#fff;padding:.25em 1em;border-radius:4px;z-index:100}.bf2-animated-gif{position:relative;display:inline-block}.bf2-animated-gif:after{content:"▶GIF";position:absolute;bottom:3px;right:4px;background-color:#069;color:#eee;font-weight:700;padding:.1em .4em;border-radius:3px;font-size:11px;line-height:normal}.arrow-span{padding:0 .2em}.bf2-moon{width:18px;height:18px;margin-left:4px;margin-bottom:10px}.bf2-moon-shadow{fill:#666}.bf2-moon-light{fill:#f5eed9}.bf2-moon-cont{display:inline-block}.bf2-switch-acc{color:#ccc;cursor:pointer;text-align:center}.bf2-switch-acc:hover{background-color:#eee;color:#000}.bf2-switch-acc__icon{display:inline-block;background:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjxzdmcgd2lkdGg9IjE3OTIiIGhlaWdodD0iMTc5MiIgdmlld0JveD0iMCAwIDE3OTIgMTc5MiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCiAgICA8cGF0aCBkPSJNMTc5MiAxMTg0djE5MnEwIDEzLTkuNSAyMi41dC0yMi41IDkuNWgtMTM3NnYxOTJxMCAxMy05LjUgMjIuNXQtMjIuNSA5LjVxLTEyIDAtMjQtMTBsLTMxOS0zMjBxLTktOS05LTIyIDAtMTQgOS0yM2wzMjAtMzIwcTktOSAyMy05IDEzIDAgMjIuNSA5LjV0OS41IDIyLjV2MTkyaDEzNzZxMTMgMCAyMi41IDkuNXQ5LjUgMjIuNXptMC01NDRxMCAxNC05IDIzbC0zMjAgMzIwcS05IDktMjMgOS0xMyAwLTIyLjUtOS41dC05LjUtMjIuNXYtMTkyaC0xMzc2cS0xMyAwLTIyLjUtOS41dC05LjUtMjIuNXYtMTkycTAtMTMgOS41LTIyLjV0MjIuNS05LjVoMTM3NnYtMTkycTAtMTQgOS0yM3QyMy05cTEyIDAgMjQgMTBsMzE5IDMxOXE5IDkgOSAyM3oiLz4NCjwvc3ZnPg==) no-repeat;background-size:contain;width:14px;height:14px;opacity:.4}.bf2-switch-account-box .bf2-lightbox-content{width:360px;height:auto;cursor:auto;border:1px solid #000;box-shadow:1px 1px 10px #00000080;background-color:#fff;padding:1em}.bf2-switch-dlg-header{font-size:120%}.bf2-switch-dlg-accounts{margin:1em 0}.bf2-switch-dlg-account{cursor:pointer;font-weight:700;border:1px solid #ddd;margin:.5em 0;position:relative}.bf2-switch-dlg-account:hover,.bf2-switch-dlg-account.-current{background-color:#eee}.bf2-switch-dlg-account.-current{cursor:not-allowed}.bf2-switch-dlg-account.-current .bf2-switch-dlg-del{display:none}.bf2-switch-dlg-upic{width:50px;height:50px;margin-right:1em;border-right:1px solid #ddd}.bf2-switch-dlg-new-form{display:none}.bf2-switch-dlg-del{position:absolute;right:0;top:50%;width:20px;height:20px;line-height:20px;text-align:center;margin-top:-10px}.bf2-switch-dlg-del:hover{color:#c00}.box{clear:both}.bf2-lightboxed-images .image-attachments a{cursor:zoom-in}.bf2-search-highlight{background-color:#ffff80}.bf2-hp-pre:empty{display:none}.bf2-hp-pre-\\({margin-right:.13em}.bf2-hp-\\({margin-left:-.13em}.bf2-hp-pre-«{margin-right:.2em}.bf2-hp-«{margin-left:-.2em}.bf2-hp-pre-\\"{margin-right:.2em}.bf2-hp-\\"{margin-left:-.2em}.bf2-hp-pre-“{margin-right:.33em}.bf2-hp-“{margin-left:-.33em}.bf2-hp-pre--{margin-right:.1em}.bf2-hp--{margin-left:-.1em}.comment .comment-icon:not(.fa-stack){position:relative;top:-2px;left:-1px;z-index:1}.comment-likes .comment-likes-list{z-index:2}.bf2-ico-bg{position:absolute;top:0;left:0;color:#fff;display:none}.comment[data-comm-props~=from] .bf2-ico-bg{display:block}.comment[data-comm-props~=from-reader] .bf2-ico-bg{color:#ededed}.comment[data-comm-props~=from-friend] .bf2-ico-bg{color:#cef4fc}.comment[data-comm-props~=from-post-author] .bf2-ico-bg{color:#b5b5b5}.comment[data-comm-props~=from-me] .bf2-ico-bg{color:#ffd061}.comment.omit-bubble .bf2-ico-bg{display:none}.bf2-comment-avatar{position:absolute;width:16px;height:16px;background-size:cover;top:0;left:-4px;z-index:1;background-color:#fff;border-radius:50%;border:1px solid #ccc;box-sizing:content-box;pointer-events:none;background-image:url(data:image/png;base64,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)}.comment.omit-bubble .bf2-comment-avatar{display:none}.bf2-gamma-frontend .highlighted .bf2-comment-avatar{top:4px;left:3px}.bf2-comments-with-avatars .comment-time{margin-right:5px}.bf2-comments-with-avatars .feed-comment-dot:after{margin-top:1px}.bf2-comments-with-avatars .comment{margin-top:10px}.bf2-comments-with-avatars .bf2-likecomm-shift{left:-9px}.bf2-comments-with-avatars .likes{position:relative;left:-2px}.bf2-comments-with-avatars .likes .icon{margin-right:7px}.bf2-comments-with-avatars .fold-comments-sticky{z-index:2}.bf2-comments-with-avatars .fold-comments-sticky i{left:-2px}.bf2-gamma-frontend.bf2-comments-with-avatars .comment.highlighted{margin-top:6px}.bf2-prvs{margin-left:1.1875rem;position:relative}.bf2-prvs__item{width:4rem;height:4rem;border:1px solid #999;object-fit:cover;border-radius:2px;cursor:pointer;margin-right:.3rem;margin-top:.3rem}.bf2-prvs__item--video{width:5rem;height:3rem}
`,he="matches"in HTMLElement.prototype?"matches":"msMatchesSelector";function C(t,e){return t[he](e)}const I=(t,e,n)=>{if(t===null)return[];var o=t.querySelectorAll(e),s=o?Array.prototype.slice.call(o):[];if(C(t,e)&&s.unshift(t),n)for(var i=0,r=s.length;i<r;i++)n(s[i]);return s},b=new Map;class fe{constructor(e,n=!0,o=!1){this.name=e,this.alwaysEnabled=o,this.enabledByDefault=n,this.requiredModules=[],this.active=!0,this._watchers=[],this._initiators=[]}init(e){this._initiators.push(e)}watch(e,n){this._watchers.push({selector:e,callback:n})}required(e){this.requiredModules.push(e)}_initiate(e){this.active&&(this._initiators.forEach(n=>n(e)),this._watchers.forEach(({selector:n,callback:o})=>I(document.body,n,s=>o(s,e))))}_trigger(e){this.active&&this._watchers.forEach(({selector:n,callback:o})=>I(e,n,s=>o(s,h)))}}function u(t,e=!0,n=!1){const o=new fe(t,e,n);return b.set(t,o),o}let h=null;function me(t){if(h)return;h=t,b.forEach(n=>{h.isModuleEnabled(n)&&n._initiate(h)}),new MutationObserver(n=>{n.forEach(o=>{for(let s=0,i=o.addedNodes.length;s<i;s++){let r=o.addedNodes[s];r.nodeType==Node.ELEMENT_NODE&&b.forEach(l=>{h.isModuleEnabled(l)&&l._trigger(r,h)})}})}).observe(document.body,{childList:!0,subtree:!0})}class F{constructor(e=null,n=!1){this.modules=new Map,b.forEach(o=>{o.alwaysEnabled||this.modules.set(o.name,o.enabledByDefault)}),this.hideAliens=!1,this.commentCloudsMode=2,e&&((e.modules||[]).forEach(([o,s])=>{(n||this.modules.has(o))&&this.modules.set(o,!!s)}),this.hideAliens=!!e.hideAliens,(e.commentCloudsMode===1||e.commentCloudsMode===2)&&(this.commentCloudsMode=e.commentCloudsMode))}toJSON(){const e={modules:[]};return this.modules.forEach((n,o)=>e.modules.push([o,n])),e.hideAliens=this.hideAliens,e.commentCloudsMode=this.commentCloudsMode,e}isModuleEnabled(e){return e&&(e.alwaysEnabled||!this.modules.has(e.name)&&e.enabledByDefault||this.modules.get(e.name))&&!e.requiredModules.map(n=>b.get(n)).some(n=>!this.isModuleEnabled(n))}}function g(t=""){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")}class Y{constructor(e){this.text=e}toString(){return this.text}}function pe(t){return new Y(t)}function N(t){return t instanceof Y}function T(t,...e){return pe(t.reduce((n,o,s)=>{let i=e[s-1];return n+(N(i)?i:g(i))+o}))}const W=Array.isArray||function(t){return Object.prototype.toString.call(t)=="[object Array]"};function a(t,e){var n,o,s=t.split("."),i=s.shift()||"div",r;i==="$"?r=document.createDocumentFragment():(r=document.createElement(i),s.length>0&&(r.className=s.join(" ")));var l=1;if(arguments.length>1&&typeof e=="object"&&!(e instanceof Node)&&!W(e)&&!N(e)){for(o in e)Object.prototype.hasOwnProperty.call(e,o)&&r.setAttribute(o,e[o]);l=2}if(arguments.length>l)for(n=l;n<arguments.length;n++)X(r,arguments[n]);return r}function X(t,e){e instanceof Node?t.appendChild(e):W(e)?e.forEach(X.bind(null,t)):typeof e=="string"?t.appendChild(document.createTextNode(e)):N(e)&&t.insertAdjacentHTML("beforeEnd",e.toString())}const B={"freefeed.net":{cookies:["freefeedBETA_authToken","freefeed_authToken"]},"gamma.freefeed.net":{cookies:["freefeed_authToken"]}},k=location.hostname,be="freefeedBETA_authToken";function m(){if(k in B)for(const t of B[k].cookies){const{userId:e,authToken:n}=ge(localStorage.getItem(t));if(e)return{userId:e,authToken:n}}return{userId:null,authToken:null}}function ge(t){if(t!==null){const e=t.split(".");if(e.length===3)try{let n=JSON.parse(atob(e[1]));if("userId"in n)return{authToken:t,userId:n.userId}}catch{}}return{authToken:null,userId:null}}const we="https://freefeed.net";async function z(t){const e=await fetch(L(t),{headers:{Accept:"application/json",Authorization:"Bearer "+m().authToken}}).then(n=>n.json());if(e&&"err"in e)throw new Error(e.err);return e}async function ye(t,e){const n=await fetch(L(t),{method:"PUT",body:e,headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer "+m().authToken}}).then(o=>o.json());if(n&&"err"in n)throw new Error(n.err);return n}async function Ae(t,e){const n=await fetch(L(t),{method:"POST",body:e,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json",Authorization:"Bearer "+m().authToken}}).then(o=>o.json());if(n&&"err"in n)throw new Error(n.err);return n}function L(t){return we+t+(t.indexOf("?")!==-1?"&":"?")+"_initiator=betterfeed2"}function xe(t){const e=window.fetch;window.fetch=(...n)=>{const o=e(...n);return o.then(s=>{const i=s.json;s.json=async()=>{const r=await i.call(s);return t({req:n,resp:r}),r}}),o}}const P=new Map,A=new Map;xe(({resp:t})=>{if(!t||typeof t!="object")return;let{users:e,subscribers:n}=t;const o=new Set;if(e)if(!Array.isArray(e))o.add(e);else for(const s of e)o.add(s);if(n)for(const s of n)o.add(s);for(const s of o)q(s.username,s.profilePictureMediumUrl)});const ve=1e3;let U=0;async function Z(t){let e=P.get(t);return e||(e=new Promise(n=>A.set(t,n)),P.set(t,e),clearTimeout(U),U=setTimeout(Me,ve)),e}function q(t,e){if(!e)return;const n=A.get(t);n?(A.delete(t),n(e)):P.set(t,Promise.resolve(e))}async function Me(){U=0;for(const t of A.keys()){const{users:e}=await z(`/v1/users/${t}`);q(e.username,e.profilePictureMediumUrl)}}const G="me.davidmz.BetterFeed2";class c{constructor(){this.me=null,this.myID=null,this.myScreenName=null,this.friends=[],this.readers=[],this.banIds=[],this.bf2Props={},this._savePropsQueue=[],this._savingPropsNow=!1,this._savingIndicator=a(".bf2-saving-settings-indicator","Saving settings…")}whoIs(e){let n=0;return e===this.me&&(n|=c.ME),this.friends.indexOf(e)!==-1&&(n|=c.FRIEND),this.readers.indexOf(e)!==-1&&(n|=c.READER),n}isBanned(e){return this.banIds.indexOf(e)!==-1}saveProps(e){return this._savePropsQueue.push(e.toJSON()),this._saveProps()}async _saveProps(){if(!this._savingPropsNow){for(document.body.appendChild(this._savingIndicator),this._savingPropsNow=!0;this._savePropsQueue.length>0;){const e=this._savePropsQueue.shift();for(let n in e)Object.prototype.hasOwnProperty.call(e,n);await ye(`/v1/users/${this.myID}`,JSON.stringify({user:{frontendPreferences:{[G]:e}}}))}this._savingPropsNow=!1,document.body.removeChild(this._savingIndicator)}}}c.ME=1,c.FRIEND=2,c.READER=4,c.ready=null,c.update=()=>{c.ready=z("/v2/users/whoami").then(t=>{const e=new c;return e.me=t.users.username,e.myID=t.users.id,e.myScreenName=t.users.screenName,e.friends=t.subscribers.map(n=>n.username),e.readers=t.users.subscribers.map(n=>n.username),e.banIds=t.users.banIds,e.bf2Props=t.users.frontendPreferences[G]||{},e})},c.update();const H=u("comment-clouds");let O=!1;H.init(t=>{O=t.commentCloudsMode===2,O&&document.body.classList.add("bf2-comments-with-avatars")}),H.watch(".comment[data-author]",async t=>{if(!(t.querySelector(".bf2-comment-ex")||t.classList.contains("comment-is-hidden")))if(O){const e=t.dataset.author,n=t.appendChild(a(".bf2-comment-avatar.bf2-comment-ex")),o=await Z(e||(await c.ready).me);n.style.backgroundImage="url("+o+")"}else t.appendChild(a("i.fa.fa-comment.icon.bf2-ico-bg.bf2-comment-ex"))});const Ee=!!Element.prototype.closest;function w(t,e,n=!1){if(t===null)return null;const o=n?t:t.parentNode;return Ee&&o?o.closest(e):o&&o.nodeType==Node.ELEMENT_NODE?C(o,e)?o:w(o,e):null}const x=[];function Se(t){x.push(t),t(location)}const Ce=history.pushState.bind(history),Ie=history.replaceState.bind(history);history.pushState=(t,e,n)=>{Ce(t,e,n),x.forEach(o=>o(location))},history.replaceState=(t,e,n)=>{Ie(t,e,n),x.forEach(o=>o(location))},window.addEventListener("popstate",()=>x.forEach(t=>t(location)));const v=u("common",!0,!0);v.init(()=>{Se(t=>{const e=t.pathname==="/",n=t.pathname==="/filter/best_of";document.body.classList.toggle("bf2-homepage",e),document.body.classList.toggle("bf2-best-of",n),document.body.classList.toggle("bf2-aggregate-page",e||n)}),document.addEventListener("click",t=>{if(t.button==0&&t.target.classList.contains("bf2-user-link")){const e=document.querySelector(`a:not(.bf2-user-link)[href="${CSS.escape(t.target.getAttribute("href"))}"]`);e&&(t.preventDefault(),t.target.blur(),e.click())}}),k==="gamma.freefeed.net"&&document.body.classList.add("bf2-gamma-frontend")}),v.watch(".timeline-post, .single-post",t=>{const e=t.querySelector(".post-timestamp").getAttribute("href").match(/^\/.+?\/([\w-]+)/)[1];t.id=`post-${e}`,t.dataset.postId=e;const n=t.querySelector(".post-author").getAttribute("href").substr(1);t.dataset.postAuthor=n,t.classList.add(`bf2-post-from-${n}`),I(t,".post-recipient").map(i=>i.getAttribute("href").substr(1)).filter(i=>i!==n).forEach(i=>t.classList.add(`bf2-post-to-${i}`));const o=t.querySelector(".post-text"),s=t.querySelector(".comment-body");(V(o.textContent)||s&&V(s.textContent))&&t.classList.add("bf2-lang-arabic")}),v.watch(".user-card .display-name",t=>{w(t,".user-card").dataset.userName=t.getAttribute("href").substr(1)}),v.watch(".comment",async t=>{const e=Ne(t);if(!e)return;const n=Te(w(t,".post"));if(!n)return;const o=[];o.push("from"),n===e&&o.push("from-post-author");const s=(await c.ready).whoIs(e);s&c.ME?o.push("from-me"):s&c.FRIEND?o.push("from-friend"):s&c.READER&&o.push("from-reader"),t.dataset.commProps=o.join(" ")});function Ne(t){let e=t.dataset.author;if(!e){const n=t.querySelector(".comment-body > .user-name-wrapper > a");n&&(e=n.getAttribute("href").substr(1),t.dataset.author=e)}return e}function Te(t){let e=t.dataset.author;if(!e){const n=t.querySelector(".post-header a.post-author");n&&(e=n.getAttribute("href").substr(1),t.dataset.author=e)}return e}function V(t){return/[\u0600-\u06ff\u0700-\u077f\u08A0-\u08ff]/.test(t)}function j(t,e){if(t.nodeType===Node.TEXT_NODE)e(t);else if(t.nodeType===Node.ELEMENT_NODE){let n=t.firstChild;for(;n;){const o=n.nextSibling;j(n,e),n=o}}}const J=u("hanging-punct");let M;J.init(()=>{M=document.createElement("div")});const K=/(^|\s)([(«“-]|&quot;)/g;J.watch(".post-text, .comment-body",t=>{if(C(t,".comment-body")){const e=t.querySelectorAll(".user-name-wrapper"),n=e[e.length-1];if(n&&n.nextElementSibling){const o=n.nextElementSibling;j(o,s=>{s.nodeValue==="("&&(s.nodeValue=" (")})}}j(t,e=>{if(e.parentNode.classList.contains("bf2-hp"))return;let n=g(e.nodeValue);if(K.test(n)){for(n=n.replace(K,'<span class="bf2-hp bf2-hp-pre bf2-hp-pre-$2">$1</span><span class="bf2-hp bf2-hp-$2">$2</span>'),M.innerHTML=n;M.firstChild;)e.parentNode.insertBefore(M.firstChild,e);e.parentNode.removeChild(e)}})});const ke=u("hide-arabic",!1);let Q=null;ke.init(()=>{Q=document.head.appendChild(a("style.bf2-hide-posts")).sheet,Q.insertRule(".bf2-aggregate-page .bf2-lang-arabic { display: none; }",0)});const Le=u("moon"),Pe=`<svg class="bf2-moon" viewBox="-4 -4 108 108" xmlns="http://www.w3.org/2000/svg" version="1.1">
        <circle class="bf2-moon-shadow" cx="50" cy="50" r="54"></circle>
        <path class="bf2-moon-light" d="M 50 0 a 30 50 0 0 0 0 100 a 50 50 0 0 0 0 -100 Z"></path>
    </svg>`;Le.watch("h1",t=>{t.appendChild(a(".bf2-moon-cont")).innerHTML=Pe,$(_()),setInterval(()=>$(_()),1e3*3600)});const Ue=new Date("Thu Apr 07 2016 14:22:37 GMT+0300").getTime(),Oe=Math.round(86400*29.53058812*1e3);function _(){return(new Date().getTime()-Ue)/Oe%1}function $(t){const e=document.querySelector(".bf2-moon");if(!e)return;const n=e.querySelector(".bf2-moon-light"),s=50*Math.abs(Math.cos(2*Math.PI*t));let i;t<.25?i=`M 50 0 a ${s} 50 0 0 1 0 100 a 50 50 0 0 0 0 -100 Z`:t<.5?i=`M 50 0 a ${s} 50 0 0 0 0 100 a 50 50 0 0 0 0 -100 Z`:t<.75?i=`M 50 0 a 50 50 0 0 0 0 100 a ${s} 50 0 0 0 0 -100 Z`:i=`M 50 0 a 50 50 0 0 0 0 100 a ${s} 50 0 0 1 0 -100 Z`,n.setAttribute("d",i),Math.abs(.5-t)<.05?e.parentNode.setAttribute("title","Achtung Vollmond!"):e.parentNode.removeAttribute("title")}u("no-comment-more",!1).watch(".comment-tail__actions",t=>{const e=t.querySelectorAll(".comment-tail__action");e.length===1?t.hidden=!0:e[e.length-1].hidden=!0});const ee=u("no-read-more",!1);ee.watch("a.read-more",t=>t.click()),ee.watch(".expand-button > i",t=>t.click());const je=u("previews-in-comments",!1),te=/^https?:\/\/(?:www\.|m\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?(?:v=|.+&v=)))([\w-]+)/i;je.watch(".comment",async t=>{if(t.querySelector(".bf2-prvs"))return;const e=t.querySelectorAll(".media-link"),n=[];for(let i=0;i<e.length;i++){const r=e[i];if(r.origin==="https://media.freefeed.net"&&/\.(jpg|png|gif|webp)$/.test(r.pathname)){let l=r.href.replace(/\/attachments(\/\w+)?\/[0-9a-f]{8}-/,R=>{const f=R.split("/");return f.length===3?f.splice(2,0,"thumbnails"):f.length===4&&(f[2]="thumbnails"),f.join("/")});l.replace(/\.webp$/,".jpg"),n.push({thumb:l,link:r})}if(te.test(r.href)){const[,l]=te.exec(r.href);n.push({thumb:`https://img.youtube.com/vi/${l}/default.jpg`,link:r,type:"video"})}}if(n.length===0)return;const o=n.map(i=>{const r=a("img.bf2-prvs__item",{src:i.thumb,loading:"lazy"});return i.type==="video"&&r.classList.add("bf2-prvs__item--video"),r.addEventListener("click",()=>i.link.click()),r.addEventListener("error",()=>r.src=i.thumb.replace("/thumbnails","")),r}),s=a(".bf2-prvs",o);t.appendChild(s)});let ne=window.__BetterFeedRoot||"https://cdn.jsdelivr.net/gh/davidmz/BetterFeed2@"+localStorage["bf2-version"];if(document.currentScript){let t=document.currentScript.src.split("/");ne=t.slice(0,t.length-2).join("/")}const oe=ne;class se{constructor(e="",n=!1){this._container=a(".bf2-lightbox-container"),e!==""&&this._container.classList.add(e);let o=this._container.appendChild(a(".bf2-lightbox-shadow"));this.contentEl=o.appendChild(a(".bf2-lightbox-content")),o.addEventListener("click",s=>{s.target===o&&!n&&this.hide()})}showContent(e){typeof e=="string"?this.contentEl.innerHTML=e:(this.contentEl.innerHTML="",this.contentEl.appendChild(e)),document.body.appendChild(this._container)}hide(){this.contentEl.innerHTML="",this._container.parentNode.removeChild(this._container)}}const ie="v2.23.0";u("settings-link",!0,!0).watch(".sidebar",t=>{if(t.querySelector(".bf2-sidebar-box"))return;const e=a("a","BetterFeed settings"),n=a(".bf2-sidebar-box.box",a(".box-header-groups","Add-ons"),a(".box-body",a("ul",a("li",e))),a(".box-footer",ie));t.querySelector(".box").parentNode.insertBefore(n,null),e.addEventListener("click",De)});async function De(){const t=oe+"/src/html/settings.html",e=(await fetch(t).then(o=>o.text())).replace(/\[\[parentOrigin]]/g,g(location.origin)).replace(/\[\[betterFeedVersion]]/g,g(ie)).replace(/\[\[baseURL]]/g,g(oe+"/")),n=URL.createObjectURL(new Blob([e],{type:"text/html;charset=utf-8"}));if(/iPhone|iPad/.test(navigator.userAgent)){window.open(n,"_blank");return}new se("bf2-settings-lightbox").showContent(a("iframe",{src:n,frameborder:"0"}))}u("show-timestamps",!1).watch(".post-lock-icon",t=>{const e=document.createEvent("MouseEvents");e.initEvent("click",!0,!0),t.dispatchEvent(e)});const Re="data:image/png;base64,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";let Fe=1;const re="@response";class ae{constructor(e=null,n=""){this.__responders=new Map,this.__listeners=new Map,this.defaultWindow=e,this.defaultOrigin=n,window.addEventListener("message",o=>{if(typeof o.data!="object")return;const{data:{action:s,requestId:i,value:r},source:l,origin:R}=o;if(s===re&&this.__responders.has(i))this.__responders.get(i)(r),this.__responders.delete(i);else if(this.__listeners.has(s)){let f=this.__listeners.get(s)(r);l.postMessage({action:re,requestId:i,value:f},R)}})}send(e,n=null){return this.sendEx(this.defaultWindow,this.defaultOrigin,e,n)}sendEx(e,n,o,s=null){return new Promise(i=>{const r=Fe++;this.__responders.set(r,i),e.postMessage({action:o,requestId:r,value:s},n)})}on(e,n){this.__listeners.set(e,n)}}const Ye="https://davidmz.github.io/BetterFeed2/storage.html?_="+Math.random(),We="https://davidmz.github.io";class Xe{constructor(){this.iframe=document.createElement("iframe"),this.iframe.src=Ye,this.iframe.style.cssText=`visibility: hidden;
            position: absolute;
            left: 0; top: 0;
            height:0; width:0;
            border: none;`,document.body.appendChild(this.iframe),this.msg=new ae(this.iframe.contentWindow,We)}get(e){return this.msg.send("get",e)}set(e,n){return this.msg.send("set",{key:e,value:n})}}const ce=u("switch-accounts"),d="bf2-switch-dlg-",E="bfAccounts-freefeed.net",Be=[{selector:`.${d}del`,handler:qe},{selector:`.${d}account`,handler:Ge},{selector:`.${d}add-new`,handler:Ze}];let y=null;ce.init(()=>{y=new Xe,document.body.addEventListener("click",t=>{Be.some(e=>{let n=w(t.target,e.selector,!0);return n?(t.preventDefault(),e.handler(n),!0):!1})})}),ce.watch(".logged-in > .avatar, .logged-in > .userpic",t=>{t.appendChild(a(".bf2-switch-acc",{title:"Switch account"},a("span.bf2-switch-acc__icon"))).addEventListener("click",ze)});let p=null;async function ze(){p=new se("bf2-switch-account-box"),p.showContent("<p>Loading…</p>"),p.showContent(await D())}async function D(){let{me:t}=await c.ready,e=a(`form.${d}new-form`,T`
      <p>Please enter username and password of your other account:</p>
      <p>
        <input
          class="form-control"
          type="text"
          name="username"
          placeholder="Username"
          required
        />
      </p>
      <p>
        <input
          class="form-control"
          type="password"
          name="password"
          placeholder="Password"
          required
        />
      </p>
      <p>
        <button type="submit" class="btn btn-default">Add</button>
      </p>
    `);return e.addEventListener("submit",n=>{n.preventDefault();let o=e.elements.username.value,s=e.elements.password.value;(async()=>{let i=await Ae("/v1/session",`username=${encodeURIComponent(o)}&password=${encodeURIComponent(s)}`);if(i.err){alert(i.err);return}let{users:{username:r},authToken:l}=i;await le(r,l),p.showContent(await D())})()}),a("",T` <div class="${d}header">Switch account to:</div>`,a(`.${d}accounts`,(await S()).map(({username:n})=>{let o=a(`img.${d}upic`,{src:Re});Z(n).then(i=>o.src=i);let s=a(`.${d}del`,{title:"Remove from list"},a("i.fa.fa-times-circle"));return a(`.${d}account${n===t?".-current":""}`,{"data-username":n},o,n,s)})),T` <div class="${d}add-new">
      <a><i class="fa fa-plus"></i> Add new account</a>
    </div>`,e)}function Ze(t){t.style.display="none",document.body.querySelector(`.${d}new-form`).style.display="block"}async function S(){let t=await y.get(E);return t||(t=[{username:(await c.ready).me,token:m().authToken}]),t}async function le(t,e){let n=await S();const o=n.find(s=>s.username===t);o?o.token=e:n.push({username:t,token:e}),await y.set(E,n)}function qe(t){return confirm("Are you sure?")?(async()=>{let{me:e}=await c.ready,n=w(t,`.${d}account`).dataset.username;if(n===e)return;let o=(await S()).filter(s=>s.username!==n);o.length===1&&o[0].username===e?await y.set(E,null):await y.set(E,o),p.showContent(await D())})():Promise.resolve()}async function Ge(t){const e=(await c.ready).me;let n=t.dataset.username;if(n===e)return;let o=null;(await S()).some(s=>s.username===n?(o=s.token,!0):!1),o&&(p.showContent("Please wait…"),await le(e,m().authToken),localStorage.setItem(be,o),location.reload())}const He=new Promise(function(t){document.readyState==="complete"||document.readyState==="interactive"?setTimeout(t,0):document.addEventListener("DOMContentLoaded",t)}),{userId:Ve}=m();/^\/(attachments\/|files\/|bookmarklet|v\d\/)/.test(location.pathname)||(!MutationObserver||!Promise?console.error("Can not start BetterFeed: MutationObserver & Promise not supported"):Ve===null?console.error("Can not start BetterFeed: user not logged in"):"__BetterFeed"in window?console.warn("BetterFeed already started"):(window.__BetterFeed=!0,Promise.all([c.ready,He]).then(([t])=>{Je(new F(t.bf2Props))})));function Je(t){de(ue),me(t);const e=new ae;e.on("getSettings",()=>t.toJSON()),e.on("saveSettings",async n=>{await(await c.ready).saveProps(new F(n)),location.reload(!0)}),e.on("checkUpdates",Ke)}function Ke(){const t=Date.now(),e="v2.23.0";localStorage["bf2-next-update"]=t+3600*1e3;const n=new XMLHttpRequest;n.open("GET","https://api.github.com/repos/davidmz/BetterFeed2/tags?page=1&per_page=1"),n.responseType="json",n.onload=()=>{try{const o=n.response;if(o.length===1&&"name"in o[0]){const s=o[0].name;localStorage["bf2-version"]=s,localStorage["bf2-next-update"]=t+24*3600*1e3,s!==e?confirm(`Доступна новая версия: ${s}. Она будет установлена после перезагрузки страницы.

Перезагрузить страницу сейчас?`)&&location.reload(!0):alert(`У вас установлена последняя версия (${s})`)}}catch{}},n.send()}})();
