{"version":3,"sources":["webpack:///settings.min.js","webpack:///webpack/bootstrap feefc7ed4618b447a9c7?c6a2","webpack:///./src/js/settings.js","webpack:///./src/js/base/modules.js?9f07","webpack:///./src/js/utils/for-select.js?ebda","webpack:///./src/js/utils/matches.js?d30e","webpack:///./src/js/utils/escape-html.js?b1be","webpack:///./src/js/base/settings.js?d926","webpack:///./src/js/utils/message-rpc.js?2bdd","webpack:///./src/js/utils/cell.js"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","id","loaded","call","m","c","p","0","_interopRequireDefault","obj","__esModule","default","getRadioValue","radioInputs","reduce","prevValue","r","checked","value","setRadioValue","forEach","_cell","_cell2","_settings","_settings2","_messageRpc","_messageRpc2","_forSelect","_forSelect2","_escapeHtml","_escapeHtml2","version","location","pathname","match","document","querySelector","appendChild","createTextNode","body","link","href","search","sPage","parentWindow","window","parent","opener","exec","alert","parentOrigin","decodeURIComponent","saveButton","getElementById","checkUpdatesButton","checkBoxes","hidePostsFromTA","ccModeInputs","msg","settings","addEventListener","disabled","style","width","offsetWidth","innerHTML","box","set","hidePostsFrom","clear","toLowerCase","u","add","commentCloudsMode","parseInt","send","toJSON","e","btn","target","then","isChanged","initialState","Map","currentState","state","input","type","updateInputs","get","s","substr","sData","node","k","dataset","fromInput","onValue","classList","remove","previousElementSibling","changeHandler","st","changed","v","distinct","5","_classCallCheck","instance","Constructor","TypeError","registerModule","name","enabledByDefault","arguments","length","undefined","alwaysEnabled","Module","registeredModules","startObserver","aSettings","isModuleEnabled","_initiate","observer","MutationObserver","mutations","mutation","_loop","i","l","addedNodes","nodeType","Node","ELEMENT_NODE","_trigger","observe","childList","subtree","Object","defineProperty","_createClass","defineProperties","props","descriptor","enumerable","configurable","writable","key","protoProps","staticProps","prototype","this","requiredModules","active","_watchers","_initiators","callback","push","selector","_ref","n","_ref2","6","_matches","_matches2","foo","nodeList","querySelectorAll","nodes","Array","slice","unshift","7","matchesMethod","HTMLElement","18","replace","20","_slicedToArray","sliceIterator","arr","_arr","_n","_d","_e","_s","_i","Symbol","iterator","next","done","err","isArray","_modules","Settings","_this","o","trustedData","Set","hideAliens","has","_this2","map","some","21","_typeof","constructor","nextRequestId","responseAction","Messenger","__responders","__listeners","defaultWindow","defaultOrigin","event","data","_event$data","action","requestId","source","origin","resp","postMessage","sendEx","Promise","resolve","55","Cell","_value","_listeners","lst","initial","derive","duration","val","timer","setTimeout","lastProm","prom","res","poke","_len","cells","_key","cell","vv","eventNames","property","HTMLInputElement","HTMLTextAreaElement","HTMLSelectElement","defaultProperty","events","split","getVal","ticker","timeout","setInterval"],"mappings":"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","file":"settings.min.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ({\n\n/***/ 0:\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar _cell = __webpack_require__(55);\n\t\n\tvar _cell2 = _interopRequireDefault(_cell);\n\t\n\tvar _settings = __webpack_require__(20);\n\t\n\tvar _settings2 = _interopRequireDefault(_settings);\n\t\n\tvar _messageRpc = __webpack_require__(21);\n\t\n\tvar _messageRpc2 = _interopRequireDefault(_messageRpc);\n\t\n\tvar _forSelect = __webpack_require__(6);\n\t\n\tvar _forSelect2 = _interopRequireDefault(_forSelect);\n\t\n\tvar _escapeHtml = __webpack_require__(18);\n\t\n\tvar _escapeHtml2 = _interopRequireDefault(_escapeHtml);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\t/** page elements fix **/\n\tvar version = location.pathname.match(/BetterFeed2\\/([^\\/]+)/);\n\tif (version) {\n\t    document.querySelector(\".version\").appendChild(document.createTextNode(version[1]));\n\t}\n\t(0, _forSelect2.default)(document.body, \".local-link\", function (link) {\n\t    return link.href += location.search;\n\t});\n\t/** page elements fix **/\n\t\n\tvar sPage = document.querySelector(\".content.settings\");\n\t\n\t// мы на странице настроек\n\tif (sPage) {\n\t    (function () {\n\t        var parentWindow = window.parent === window ? window.opener : window.parent;\n\t\n\t        if (!parentWindow || !/[?&]origin=([^&]+)/.exec(location.search)) {\n\t            alert(\"Пожалуйста, откройте эту страницу по ссылке из FreeFeed-а\");\n\t        }\n\t\n\t        var parentOrigin = decodeURIComponent(/[?&]origin=([^&]+)/.exec(location.search)[1]),\n\t            saveButton = document.getElementById(\"save-settings\"),\n\t            checkUpdatesButton = document.getElementById(\"check-updates\"),\n\t            checkBoxes = (0, _forSelect2.default)(sPage, \"input[type='checkbox']\"),\n\t            hidePostsFromTA = document.getElementById(\"hide-posts-from-users\"),\n\t            ccModeInputs = (0, _forSelect2.default)(sPage, \"input[name='comment-clouds-mode']\"),\n\t            msg = new _messageRpc2.default(parentWindow, parentOrigin);\n\t\n\t        /** @type {Settings|null} */\n\t        var settings = null;\n\t\n\t        saveButton.addEventListener(\"click\", function () {\n\t            saveButton.disabled = true;\n\t            saveButton.style.width = saveButton.offsetWidth + \"px\";\n\t            saveButton.innerHTML = (0, _escapeHtml2.default)(\"Сохраняем…\");\n\t\n\t            checkBoxes.forEach(function (box) {\n\t                return settings.modules.set(box.id, box.checked);\n\t            });\n\t            {\n\t                settings.hidePostsFrom.clear();\n\t                (hidePostsFromTA.value.toLowerCase().match(/\\w+/g) || []).forEach(function (u) {\n\t                    return settings.hidePostsFrom.add(u);\n\t                });\n\t            }\n\t            settings.commentCloudsMode = parseInt(getRadioValue(ccModeInputs));\n\t            msg.send(\"saveSettings\", settings.toJSON());\n\t        });\n\t\n\t        checkUpdatesButton.addEventListener(\"click\", function (e) {\n\t            var btn = e.target;\n\t            btn.disabled = true;\n\t            msg.send(\"checkUpdates\").then(function () {\n\t                return btn.disabled = false;\n\t            });\n\t        });\n\t\n\t        var isChanged = new _cell2.default(false);\n\t        var initialState = new Map();\n\t        var currentState = function currentState() {\n\t            var state = new Map();\n\t            (0, _forSelect2.default)(sPage, \"input, textarea\", function (input) {\n\t                if (input.id) {\n\t                    state.set(input.id, input.type === \"checkbox\" ? input.checked : input.value);\n\t                }\n\t            });\n\t            state.set(\"comment-clouds-mode\", getRadioValue(ccModeInputs));\n\t            return state;\n\t        };\n\t        var updateInputs = function updateInputs() {\n\t            checkBoxes.forEach(function (box) {\n\t                return box.checked = settings.modules.get(box.id);\n\t            });\n\t            {\n\t                var s = \"\";\n\t                settings.hidePostsFrom.forEach(function (u) {\n\t                    return s += \", \" + u;\n\t                });\n\t                hidePostsFromTA.value = s.substr(2);\n\t            }\n\t            setRadioValue(ccModeInputs, settings.commentCloudsMode);\n\t        };\n\t\n\t        msg.send(\"getSettings\").then(function (sData) {\n\t            settings = new _settings2.default(sData, true);\n\t            updateInputs();\n\t\n\t            // Взаимосвязь между флагами\n\t            (0, _forSelect2.default)(sPage, \"[data-disabled-if]\", function (node) {\n\t                var k = node.dataset[\"disabledIf\"],\n\t                    c = document.getElementById(k);\n\t                if (c) {\n\t                    _cell2.default.fromInput(c).onValue(function (checked) {\n\t                        return node.disabled = checked;\n\t                    });\n\t                }\n\t            });\n\t\n\t            (0, _forSelect2.default)(sPage, \"[data-enabled-if]\", function (node) {\n\t                var k = node.dataset[\"enabledIf\"],\n\t                    c = document.getElementById(k);\n\t                if (c) {\n\t                    _cell2.default.fromInput(c).onValue(function (checked) {\n\t                        return node.disabled = !checked;\n\t                    });\n\t                }\n\t            });\n\t\n\t            initialState = currentState();\n\t\n\t            sPage.classList.remove(\"hidden\");\n\t            sPage.previousElementSibling.classList.add(\"hidden\");\n\t        });\n\t\n\t        var changeHandler = function changeHandler() {\n\t            var st = currentState(),\n\t                changed = false;\n\t            st.forEach(function (v, k) {\n\t                return changed = changed || v !== initialState.get(k);\n\t            });\n\t            isChanged.value = changed;\n\t        };\n\t\n\t        sPage.addEventListener(\"input\", changeHandler);\n\t        sPage.addEventListener(\"change\", changeHandler);\n\t\n\t        isChanged.distinct().onValue(function (s) {\n\t            return saveButton.disabled = !s;\n\t        });\n\t    })();\n\t}\n\t\n\tfunction getRadioValue(radioInputs) {\n\t    return radioInputs.reduce(function (prevValue, r) {\n\t        return r.checked ? r.value : prevValue;\n\t    }, null);\n\t}\n\t\n\tfunction setRadioValue(radioInputs, value) {\n\t    radioInputs.forEach(function (r) {\n\t        return r.checked = r.value == value;\n\t    });\n\t}\n\n/***/ },\n\n/***/ 5:\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\texports.registeredModules = undefined;\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\texports.registerModule = registerModule;\n\texports.startObserver = startObserver;\n\t\n\tvar _forSelect = __webpack_require__(6);\n\t\n\tvar _forSelect2 = _interopRequireDefault(_forSelect);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar registeredModules = exports.registeredModules = new Map(); // name → module\n\t\n\tvar Module = function () {\n\t    function Module(name) {\n\t        var enabledByDefault = arguments.length <= 1 || arguments[1] === undefined ? true : arguments[1];\n\t        var alwaysEnabled = arguments.length <= 2 || arguments[2] === undefined ? false : arguments[2];\n\t\n\t        _classCallCheck(this, Module);\n\t\n\t        this.name = name;\n\t        this.alwaysEnabled = alwaysEnabled;\n\t        this.enabledByDefault = enabledByDefault;\n\t        this.requiredModules = [];\n\t        /**\r\n\t         * Флаг, позволяющий отключить активность модуля, даже если он разрешён в настройках.\r\n\t         * Например, если фронтенд или браузер не поддерживает необходимые фичи.\r\n\t         * @type {boolean}\r\n\t         */\n\t        this.active = true;\n\t        this._watchers = [];\n\t        this._initiators = [];\n\t    }\n\t\n\t    _createClass(Module, [{\n\t        key: \"init\",\n\t        value: function init(callback) {\n\t            this._initiators.push(callback);\n\t        }\n\t    }, {\n\t        key: \"watch\",\n\t        value: function watch(selector, callback) {\n\t            this._watchers.push({ selector: selector, callback: callback });\n\t        }\n\t    }, {\n\t        key: \"required\",\n\t        value: function required(name) {\n\t            this.requiredModules.push(name);\n\t        }\n\t    }, {\n\t        key: \"_initiate\",\n\t        value: function _initiate(settings) {\n\t            if (!this.active) {\n\t                return;\n\t            }\n\t            this._initiators.forEach(function (c) {\n\t                return c(settings);\n\t            });\n\t            this._watchers.forEach(function (_ref) {\n\t                var selector = _ref.selector;\n\t                var callback = _ref.callback;\n\t                return (0, _forSelect2.default)(document.body, selector, function (n) {\n\t                    return callback(n, settings);\n\t                });\n\t            });\n\t        }\n\t    }, {\n\t        key: \"_trigger\",\n\t        value: function _trigger(node) {\n\t            if (!this.active) {\n\t                return;\n\t            }\n\t            this._watchers.forEach(function (_ref2) {\n\t                var selector = _ref2.selector;\n\t                var callback = _ref2.callback;\n\t                return (0, _forSelect2.default)(node, selector, function (n) {\n\t                    return callback(n, settings);\n\t                });\n\t            });\n\t        }\n\t    }]);\n\t\n\t    return Module;\n\t}();\n\t\n\tfunction registerModule(name) {\n\t    var enabledByDefault = arguments.length <= 1 || arguments[1] === undefined ? true : arguments[1];\n\t    var alwaysEnabled = arguments.length <= 2 || arguments[2] === undefined ? false : arguments[2];\n\t\n\t    var m = new Module(name, enabledByDefault, alwaysEnabled);\n\t    registeredModules.set(name, m);\n\t    return m;\n\t}\n\t\n\tvar settings = null;\n\t/**\r\n\t *\r\n\t * @param {Settings} aSettings\r\n\t */\n\tfunction startObserver(aSettings) {\n\t    if (settings) {\n\t        return;\n\t    }\n\t    settings = aSettings;\n\t\n\t    registeredModules.forEach(function (m) {\n\t        if (settings.isModuleEnabled(m)) {\n\t            m._initiate(settings);\n\t        }\n\t    });\n\t\n\t    var observer = new MutationObserver(function (mutations) {\n\t        mutations.forEach(function (mutation) {\n\t            var _loop = function _loop(i, l) {\n\t                var node = mutation.addedNodes[i];\n\t                if (node.nodeType == Node.ELEMENT_NODE) {\n\t                    registeredModules.forEach(function (m) {\n\t                        if (settings.isModuleEnabled(m)) {\n\t                            m._trigger(node, settings);\n\t                        }\n\t                    });\n\t                }\n\t            };\n\t\n\t            for (var i = 0, l = mutation.addedNodes.length; i < l; i++) {\n\t                _loop(i, l);\n\t            }\n\t        });\n\t    });\n\t\n\t    observer.observe(document.body, { childList: true, subtree: true });\n\t}\n\n/***/ },\n\n/***/ 6:\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _matches = __webpack_require__(7);\n\t\n\tvar _matches2 = _interopRequireDefault(_matches);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\t/**\r\n\t * @param {Document|DocumentFragment|Element} node\r\n\t * @param {string} selector\r\n\t * @param {function(Node)} [foo]\r\n\t */\n\t\n\texports.default = function (node, selector, foo) {\n\t    if (node === null) return [];\n\t    var nodeList = node.querySelectorAll(selector);\n\t    var nodes = nodeList ? Array.prototype.slice.call(nodeList) : [];\n\t    if ((0, _matches2.default)(node, selector)) nodes.unshift(node);\n\t    if (foo) {\n\t        for (var i = 0, l = nodes.length; i < l; i++) {\n\t            foo(nodes[i]);\n\t        }\n\t    }\n\t    return nodes;\n\t};\n\n/***/ },\n\n/***/ 7:\n/***/ function(module, exports) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\texports.default = function (node, selector) {\n\t  return node[matchesMethod](selector);\n\t};\n\t\n\tvar matchesMethod = \"matches\" in HTMLElement.prototype ? \"matches\" : \"msMatchesSelector\";\n\t\n\t/**\r\n\t *\r\n\t * @param {HTMLElement} node\r\n\t * @param {String} selector\r\n\t * @return {Boolean}\r\n\t */\n\n/***/ },\n\n/***/ 18:\n/***/ function(module, exports) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\texports.default = function () {\n\t  var s = arguments.length <= 0 || arguments[0] === undefined ? \"\" : arguments[0];\n\t\n\t  return s.replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\").replace(/\"/g, \"&quot;\").replace(/'/g, \"&#x27;\");\n\t};\n\n/***/ },\n\n/***/ 20:\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _modules = __webpack_require__(5);\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar Settings = function () {\n\t    function Settings() {\n\t        var _this = this;\n\t\n\t        var o = arguments.length <= 0 || arguments[0] === undefined ? null : arguments[0];\n\t        var trustedData = arguments.length <= 1 || arguments[1] === undefined ? false : arguments[1];\n\t\n\t        _classCallCheck(this, Settings);\n\t\n\t        this.modules = new Map();\n\t        _modules.registeredModules.forEach(function (m) {\n\t            if (!m.alwaysEnabled) {\n\t                _this.modules.set(m.name, m.enabledByDefault);\n\t            }\n\t        });\n\t\n\t        this.hidePostsFrom = new Set();\n\t        this.hideAliens = false;\n\t        this.commentCloudsMode = 2;\n\t\n\t        // инициализация из объекта\n\t        if (o) {\n\t            (o.modules || []).forEach(function (_ref) {\n\t                var _ref2 = _slicedToArray(_ref, 2);\n\t\n\t                var k = _ref2[0];\n\t                var v = _ref2[1];\n\t\n\t                if (trustedData || _this.modules.has(k)) {\n\t                    _this.modules.set(k, !!v);\n\t                }\n\t            });\n\t            (o.hidePostsFrom || []).forEach(function (u) {\n\t                return _this.hidePostsFrom.add(u);\n\t            });\n\t            this.hideAliens = !!o.hideAliens;\n\t            if (o.commentCloudsMode === 1 || o.commentCloudsMode === 2) {\n\t                this.commentCloudsMode = o.commentCloudsMode;\n\t            }\n\t        }\n\t    }\n\t\n\t    _createClass(Settings, [{\n\t        key: \"toJSON\",\n\t        value: function toJSON() {\n\t            var o = { modules: [], hidePostsFrom: [] };\n\t            this.modules.forEach(function (v, k) {\n\t                return o.modules.push([k, v]);\n\t            });\n\t            this.hidePostsFrom.forEach(function (u) {\n\t                return o.hidePostsFrom.push(u);\n\t            });\n\t            o.hideAliens = this.hideAliens;\n\t            o.commentCloudsMode = this.commentCloudsMode;\n\t            return o;\n\t        }\n\t\n\t        /**\r\n\t         * @param {Module} m\r\n\t         * @return {boolean}\r\n\t         */\n\t\n\t    }, {\n\t        key: \"isModuleEnabled\",\n\t        value: function isModuleEnabled(m) {\n\t            var _this2 = this;\n\t\n\t            return (m.alwaysEnabled || !this.modules.has(m.name) && m.enabledByDefault || this.modules.get(m.name)) && !m.requiredModules.map(function (name) {\n\t                return _modules.registeredModules.get(name);\n\t            }).some(function (m) {\n\t                return !_this2.isModuleEnabled(m);\n\t            });\n\t        }\n\t    }]);\n\t\n\t    return Settings;\n\t}();\n\t\n\texports.default = Settings;\n\n/***/ },\n\n/***/ 21:\n/***/ function(module, exports) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; };\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar nextRequestId = 1;\n\t\n\tvar responseAction = \"@response\";\n\t\n\tvar Messenger = function () {\n\t    function Messenger() {\n\t        var _this = this;\n\t\n\t        var parentWindow = arguments.length <= 0 || arguments[0] === undefined ? null : arguments[0];\n\t        var parentOrigin = arguments.length <= 1 || arguments[1] === undefined ? \"\" : arguments[1];\n\t\n\t        _classCallCheck(this, Messenger);\n\t\n\t        this.__responders = new Map();\n\t        this.__listeners = new Map();\n\t\n\t        this.defaultWindow = parentWindow;\n\t        this.defaultOrigin = parentOrigin;\n\t\n\t        window.addEventListener('message', function (event) {\n\t            if (_typeof(event.data) !== \"object\") {\n\t                return;\n\t            }\n\t            //noinspection UnnecessaryLocalVariableJS\n\t            var _event$data = event.data;\n\t            var action = _event$data.action;\n\t            var requestId = _event$data.requestId;\n\t            var value = _event$data.value;\n\t            var source = event.source;\n\t            var origin = event.origin;\n\t\n\t\n\t            if (action === responseAction && _this.__responders.has(requestId)) {\n\t                _this.__responders.get(requestId)(value);\n\t                _this.__responders.delete(requestId);\n\t            } else if (_this.__listeners.has(action)) {\n\t                var resp = _this.__listeners.get(action)(value);\n\t                source.postMessage({ action: responseAction, requestId: requestId, value: resp }, origin);\n\t            }\n\t        });\n\t    }\n\t\n\t    /**\r\n\t     *\r\n\t     * @param {String} action\r\n\t     * @param {*} value\r\n\t     * @return {Promise}\r\n\t     */\n\t\n\t\n\t    _createClass(Messenger, [{\n\t        key: \"send\",\n\t        value: function send(action) {\n\t            var value = arguments.length <= 1 || arguments[1] === undefined ? null : arguments[1];\n\t\n\t            return this.sendEx(this.defaultWindow, this.defaultOrigin, action, value);\n\t        }\n\t\n\t        /**\r\n\t         *\r\n\t         * @param {Window} window\r\n\t         * @param {String} origin\r\n\t         * @param {String} action\r\n\t         * @param {*} value\r\n\t         * @return {Promise}\r\n\t         */\n\t\n\t    }, {\n\t        key: \"sendEx\",\n\t        value: function sendEx(window, origin, action) {\n\t            var _this2 = this;\n\t\n\t            var value = arguments.length <= 3 || arguments[3] === undefined ? null : arguments[3];\n\t\n\t            return new Promise(function (resolve) {\n\t                var requestId = nextRequestId++;\n\t                _this2.__responders.set(requestId, resolve);\n\t                window.postMessage({ action: action, requestId: requestId, value: value }, origin);\n\t            });\n\t        }\n\t\n\t        /**\r\n\t         *\r\n\t         * @param {String} action\r\n\t         * @param {function} callback\r\n\t         */\n\t\n\t    }, {\n\t        key: \"on\",\n\t        value: function on(action, callback) {\n\t            this.__listeners.set(action, callback);\n\t        }\n\t    }]);\n\t\n\t    return Messenger;\n\t}();\n\t\n\texports.default = Messenger;\n\n/***/ },\n\n/***/ 55:\n/***/ function(module, exports) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar Cell = function () {\n\t    function Cell(value) {\n\t        _classCallCheck(this, Cell);\n\t\n\t        this._value = value;\n\t        this._listeners = new Set();\n\t    }\n\t\n\t    _createClass(Cell, [{\n\t        key: \"poke\",\n\t        value: function poke() {\n\t            var _this = this;\n\t\n\t            this._listeners.forEach(function (l) {\n\t                return l(_this._value);\n\t            });\n\t        }\n\t    }, {\n\t        key: \"onValue\",\n\t        value: function onValue(lst) {\n\t            this._listeners.add(lst);\n\t            lst(this.value);\n\t            return this;\n\t        }\n\t    }, {\n\t        key: \"unListen\",\n\t        value: function unListen(lst) {\n\t            this._listeners.delete(lst);\n\t            return this;\n\t        }\n\t\n\t        /**\r\n\t         * @param {function(Cell, *)} foo\r\n\t         * @param {*} [initial]\r\n\t         * @return {Cell}\r\n\t         */\n\t\n\t    }, {\n\t        key: \"derive\",\n\t        value: function derive(foo, initial) {\n\t            var c = new Cell(initial);\n\t            this.onValue(function (v) {\n\t                return foo(c, v);\n\t            });\n\t            return c;\n\t        }\n\t\n\t        /**\r\n\t         * @param {Array.<Cell>} cells\r\n\t         * @return {Cell}\r\n\t         */\n\t\n\t    }, {\n\t        key: \"map\",\n\t        value: function map(foo) {\n\t            return this.derive(function (c, v) {\n\t                return c.value = foo(v);\n\t            });\n\t        }\n\t    }, {\n\t        key: \"filter\",\n\t        value: function filter(foo) {\n\t            return this.derive(function (c, v) {\n\t                return foo(v) && (c.value = v);\n\t            });\n\t        }\n\t    }, {\n\t        key: \"throttle\",\n\t        value: function throttle(duration) {\n\t            var _this2 = this;\n\t\n\t            var val = undefined,\n\t                timer = null;\n\t\n\t            return this.derive(function (c, v) {\n\t                val = v;\n\t                if (!timer) {\n\t                    timer = setTimeout(function () {\n\t                        if (val !== undefined) {\n\t                            c.value = _this2.value;\n\t                            val = undefined;\n\t                        }\n\t                        timer = null;\n\t                    }, duration);\n\t                }\n\t            }, this.value);\n\t        }\n\t\n\t        /**\r\n\t         * For cell with Promise's values\r\n\t         * @param {*} [initial]\r\n\t         * @return {Cell}\r\n\t         */\n\t\n\t    }, {\n\t        key: \"latestPromise\",\n\t        value: function latestPromise(initial) {\n\t            var lastProm = null;\n\t            return this.derive(function (c, v) {\n\t                var prom = v;\n\t                lastProm = prom;\n\t                prom.then(function (res) {\n\t                    if (prom === lastProm) {\n\t                        c.value = res;\n\t                    }\n\t                });\n\t            }, initial);\n\t        }\n\t    }, {\n\t        key: \"distinct\",\n\t        value: function distinct() {\n\t            var val;\n\t            return this.derive(function (c, v) {\n\t                if (v !== val) {\n\t                    val = v;\n\t                    c.value = v;\n\t                }\n\t            });\n\t        }\n\t    }, {\n\t        key: \"value\",\n\t        get: function get() {\n\t            return this._value;\n\t        },\n\t        set: function set(v) {\n\t            this._value = v;\n\t            this.poke();\n\t        }\n\t    }], [{\n\t        key: \"combine\",\n\t        value: function combine() {\n\t            for (var _len = arguments.length, cells = Array(_len), _key = 0; _key < _len; _key++) {\n\t                cells[_key] = arguments[_key];\n\t            }\n\t\n\t            var cell = new Cell(cells.map(function (c) {\n\t                return c.value;\n\t            }));\n\t            cells.forEach(function (c, i) {\n\t                return c.onValue(function (v) {\n\t                    var vv = cell.value;\n\t                    vv[i] = v;\n\t                    cell.value = vv;\n\t                });\n\t            });\n\t            return cell;\n\t        }\n\t    }, {\n\t        key: \"fromInput\",\n\t        value: function fromInput(input, eventNames, property) {\n\t            if (!input || !(input instanceof HTMLInputElement || input instanceof HTMLTextAreaElement || input instanceof HTMLSelectElement)) {\n\t                return new Cell(null);\n\t            }\n\t\n\t            var defaultProperty = \"value\";\n\t            if (input instanceof HTMLInputElement && (input.type === \"checkbox\" || input.type === \"radio\")) {\n\t                defaultProperty = \"checked\";\n\t            }\n\t\n\t            var events = eventNames ? eventNames.split(\" \") : [\"input\", \"change\"];\n\t            property = property || defaultProperty;\n\t\n\t            var getVal = function getVal() {\n\t                return property === \"self\" ? input : input[property];\n\t            };\n\t\n\t            var cell = new Cell(getVal());\n\t            events.forEach(function (event) {\n\t                return input.addEventListener(event, function () {\n\t                    return cell.value = getVal();\n\t                });\n\t            });\n\t            return cell;\n\t        }\n\t    }, {\n\t        key: \"ticker\",\n\t        value: function ticker(timeout) {\n\t            var ticker = new Cell(true);\n\t            setInterval(function () {\n\t                return ticker.value = true;\n\t            }, timeout);\n\t            return ticker;\n\t        }\n\t    }]);\n\t\n\t    return Cell;\n\t}();\n\t\n\texports.default = Cell;\n\n/***/ }\n\n/******/ });\n\n\n/** WEBPACK FOOTER **\n ** settings.min.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap feefc7ed4618b447a9c7\n **/","import Cell      from \"./utils/cell\";\r\nimport Settings  from \"./base/settings\";\r\nimport Messenger from \"./utils/message-rpc\";\r\nimport forSelect from \"./utils/for-select\";\r\nimport escapeHTML from \"./utils/escape-html\";\r\n\r\n\r\n/** page elements fix **/\r\nconst version = location.pathname.match(/BetterFeed2\\/([^\\/]+)/);\r\nif (version) {\r\n    document.querySelector(\".version\").appendChild(document.createTextNode(version[1]));\r\n}\r\nforSelect(document.body, \".local-link\", link => link.href += location.search);\r\n/** page elements fix **/\r\n\r\nconst sPage = document.querySelector(\".content.settings\");\r\n\r\n// мы на странице настроек\r\nif (sPage) {\r\n    const parentWindow = (window.parent === window) ? window.opener : window.parent;\r\n\r\n    if (!parentWindow || !/[?&]origin=([^&]+)/.exec(location.search)) {\r\n        alert(\"Пожалуйста, откройте эту страницу по ссылке из FreeFeed-а\");\r\n    }\r\n\r\n    const\r\n        parentOrigin = decodeURIComponent(/[?&]origin=([^&]+)/.exec(location.search)[1]),\r\n        saveButton = document.getElementById(\"save-settings\"),\r\n        checkUpdatesButton = document.getElementById(\"check-updates\"),\r\n        checkBoxes = forSelect(sPage, \"input[type='checkbox']\"),\r\n        hidePostsFromTA = document.getElementById(\"hide-posts-from-users\"),\r\n        ccModeInputs = forSelect(sPage, \"input[name='comment-clouds-mode']\"),\r\n        msg = new Messenger(parentWindow, parentOrigin);\r\n\r\n    /** @type {Settings|null} */\r\n    let settings = null;\r\n\r\n    saveButton.addEventListener(\"click\", () => {\r\n        saveButton.disabled = true;\r\n        saveButton.style.width = saveButton.offsetWidth + \"px\";\r\n        saveButton.innerHTML = escapeHTML(\"Сохраняем\\u2026\");\r\n\r\n        checkBoxes.forEach(box => settings.modules.set(box.id, box.checked));\r\n        {\r\n            settings.hidePostsFrom.clear();\r\n            (hidePostsFromTA.value.toLowerCase().match(/\\w+/g) || []).forEach(u => settings.hidePostsFrom.add(u));\r\n        }\r\n        settings.commentCloudsMode = parseInt(getRadioValue(ccModeInputs));\r\n        msg.send(\"saveSettings\", settings.toJSON());\r\n    });\r\n\r\n    checkUpdatesButton.addEventListener(\"click\", e => {\r\n        const btn = e.target;\r\n        btn.disabled = true;\r\n        msg.send(\"checkUpdates\").then(() => btn.disabled = false);\r\n    });\r\n\r\n    let isChanged = new Cell(false);\r\n    let initialState = new Map;\r\n    let currentState = () => {\r\n        let state = new Map;\r\n        forSelect(sPage, \"input, textarea\", input => {\r\n            if (input.id) {\r\n                state.set(input.id, (input.type === \"checkbox\") ? input.checked : input.value);\r\n            }\r\n        });\r\n        state.set(\"comment-clouds-mode\", getRadioValue(ccModeInputs));\r\n        return state;\r\n    };\r\n    let updateInputs = () => {\r\n        checkBoxes.forEach(box => box.checked = settings.modules.get(box.id));\r\n        {\r\n            let s = \"\";\r\n            settings.hidePostsFrom.forEach(u => s += `, ${u}`);\r\n            hidePostsFromTA.value = s.substr(2);\r\n        }\r\n        setRadioValue(ccModeInputs, settings.commentCloudsMode);\r\n    };\r\n\r\n    msg.send(\"getSettings\").then(sData => {\r\n        settings = new Settings(sData, true);\r\n        updateInputs();\r\n\r\n        // Взаимосвязь между флагами\r\n        forSelect(sPage, \"[data-disabled-if]\", node => {\r\n            let k = node.dataset[\"disabledIf\"],\r\n                c = document.getElementById(k);\r\n            if (c) {\r\n                Cell.fromInput(c).onValue(checked => node.disabled = checked);\r\n            }\r\n        });\r\n\r\n        forSelect(sPage, \"[data-enabled-if]\", node => {\r\n            let k = node.dataset[\"enabledIf\"],\r\n                c = document.getElementById(k);\r\n            if (c) {\r\n                Cell.fromInput(c).onValue(checked => node.disabled = !checked);\r\n            }\r\n        });\r\n\r\n        initialState = currentState();\r\n\r\n        sPage.classList.remove(\"hidden\");\r\n        sPage.previousElementSibling.classList.add(\"hidden\");\r\n    });\r\n\r\n    let changeHandler = () => {\r\n        let st = currentState(), changed = false;\r\n        st.forEach((v, k) => changed = changed || (v !== initialState.get(k)));\r\n        isChanged.value = changed;\r\n    };\r\n\r\n    sPage.addEventListener(\"input\", changeHandler);\r\n    sPage.addEventListener(\"change\", changeHandler);\r\n\r\n    isChanged.distinct().onValue(s => saveButton.disabled = !s);\r\n}\r\n\r\nfunction getRadioValue(radioInputs) {\r\n    return radioInputs.reduce((prevValue, r) => r.checked ? r.value : prevValue, null);\r\n}\r\n\r\nfunction setRadioValue(radioInputs, value) {\r\n    radioInputs.forEach(r => r.checked = (r.value == value));\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/settings.js\n **/","import forSelect from \"../utils/for-select\";\r\n\r\nexport const registeredModules = new Map(); // name → module\r\n\r\nclass Module {\r\n    constructor(name, enabledByDefault = true, alwaysEnabled = false) {\r\n        this.name = name;\r\n        this.alwaysEnabled = alwaysEnabled;\r\n        this.enabledByDefault = enabledByDefault;\r\n        this.requiredModules = [];\r\n        /**\r\n         * Флаг, позволяющий отключить активность модуля, даже если он разрешён в настройках.\r\n         * Например, если фронтенд или браузер не поддерживает необходимые фичи.\r\n         * @type {boolean}\r\n         */\r\n        this.active = true;\r\n        this._watchers = [];\r\n        this._initiators = [];\r\n    }\r\n\r\n    init(callback) {\r\n        this._initiators.push(callback);\r\n    }\r\n\r\n    watch(selector, callback) {\r\n        this._watchers.push({selector, callback});\r\n    }\r\n\r\n    required(name) {\r\n        this.requiredModules.push(name);\r\n    }\r\n\r\n    _initiate(settings) {\r\n        if (!this.active) {\r\n            return;\r\n        }\r\n        this._initiators.forEach(c => c(settings));\r\n        this._watchers.forEach(({selector, callback}) => forSelect(document.body, selector, n => callback(n, settings)));\r\n    }\r\n\r\n    _trigger(node) {\r\n        if (!this.active) {\r\n            return;\r\n        }\r\n        this._watchers.forEach(({selector, callback}) => forSelect(node, selector, n => callback(n, settings)));\r\n    }\r\n}\r\n\r\nexport function registerModule(name, enabledByDefault = true, alwaysEnabled = false) {\r\n    const m = new Module(name, enabledByDefault, alwaysEnabled);\r\n    registeredModules.set(name, m);\r\n    return m;\r\n}\r\n\r\nlet settings = null;\r\n/**\r\n *\r\n * @param {Settings} aSettings\r\n */\r\nexport function startObserver(aSettings) {\r\n    if (settings) {\r\n        return;\r\n    }\r\n    settings = aSettings;\r\n\r\n    registeredModules.forEach(m => {\r\n        if (settings.isModuleEnabled(m)) {\r\n            m._initiate(settings);\r\n        }\r\n    });\r\n\r\n    let observer = new MutationObserver(mutations => {\r\n        mutations.forEach(mutation => {\r\n            for (let i = 0, l = mutation.addedNodes.length; i < l; i++) {\r\n                let node = mutation.addedNodes[i];\r\n                if (node.nodeType == Node.ELEMENT_NODE) {\r\n                    registeredModules.forEach(m => {\r\n                        if (settings.isModuleEnabled(m)) {\r\n                            m._trigger(node, settings);\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n        });\r\n    });\r\n\r\n    observer.observe(document.body, {childList: true, subtree: true});\r\n\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/base/modules.js\n **/","import matches from \"./matches\";\r\n\r\n/**\r\n * @param {Document|DocumentFragment|Element} node\r\n * @param {string} selector\r\n * @param {function(Node)} [foo]\r\n */\r\nexport default (node, selector, foo) => {\r\n    if (node === null) return [];\r\n    var nodeList = node.querySelectorAll(selector);\r\n    var nodes = nodeList ? Array.prototype.slice.call(nodeList) : [];\r\n    if (matches(node, selector)) nodes.unshift(node);\r\n    if (foo) {\r\n        for (var i = 0, l = nodes.length; i < l; i++) {\r\n            foo(nodes[i]);\r\n        }\r\n    }\r\n    return nodes;\r\n};\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/utils/for-select.js\n **/","const matchesMethod = (\"matches\" in HTMLElement.prototype) ? \"matches\" : \"msMatchesSelector\";\r\n\r\n/**\r\n *\r\n * @param {HTMLElement} node\r\n * @param {String} selector\r\n * @return {Boolean}\r\n */\r\nexport default function (node, selector) { return node[matchesMethod](selector); }\r\n\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/utils/matches.js\n **/","/**\r\n * @param {string} s\r\n * @return {string}\r\n */\r\nexport default function (s = \"\") {\r\n    return s.replace(/&/g, \"&amp;\")\r\n        .replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\")\r\n        .replace(/\"/g, \"&quot;\").replace(/'/g, \"&#x27;\");\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/utils/escape-html.js\n **/","import {registeredModules} from \"./modules\";\r\n\r\nexport default class Settings {\r\n\r\n    constructor(o = null, trustedData = false) {\r\n        this.modules = new Map;\r\n        registeredModules.forEach(m => {\r\n            if (!m.alwaysEnabled) {\r\n                this.modules.set(m.name, m.enabledByDefault);\r\n            }\r\n        });\r\n\r\n        this.hidePostsFrom = new Set;\r\n        this.hideAliens = false;\r\n        this.commentCloudsMode = 2;\r\n\r\n        // инициализация из объекта\r\n        if (o) {\r\n            (o.modules || []).forEach(([k, v]) => {\r\n                if (trustedData || this.modules.has(k)) {\r\n                    this.modules.set(k, !!v);\r\n                }\r\n            });\r\n            (o.hidePostsFrom || []).forEach(u => this.hidePostsFrom.add(u));\r\n            this.hideAliens = !!o.hideAliens;\r\n            if (o.commentCloudsMode === 1 || o.commentCloudsMode === 2) {\r\n                this.commentCloudsMode = o.commentCloudsMode;\r\n            }\r\n        }\r\n    }\r\n\r\n    toJSON() {\r\n        const o = {modules: [], hidePostsFrom: []};\r\n        this.modules.forEach((v, k) => o.modules.push([k, v]));\r\n        this.hidePostsFrom.forEach(u => o.hidePostsFrom.push(u));\r\n        o.hideAliens = this.hideAliens;\r\n        o.commentCloudsMode = this.commentCloudsMode;\r\n        return o;\r\n    }\r\n\r\n    /**\r\n     * @param {Module} m\r\n     * @return {boolean}\r\n     */\r\n    isModuleEnabled(m) {\r\n        return (\r\n            (m.alwaysEnabled || !this.modules.has(m.name) && m.enabledByDefault || this.modules.get(m.name))\r\n            && !m.requiredModules.map(name => registeredModules.get(name)).some(m => !this.isModuleEnabled(m))\r\n        );\r\n    }\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/base/settings.js\n **/","let nextRequestId = 1;\r\n\r\nconst responseAction = \"@response\";\r\n\r\nexport default class Messenger {\r\n\r\n    constructor(parentWindow = null, parentOrigin = \"\") {\r\n        this.__responders = new Map();\r\n        this.__listeners = new Map();\r\n\r\n        this.defaultWindow = parentWindow;\r\n        this.defaultOrigin = parentOrigin;\r\n\r\n        window.addEventListener('message', event => {\r\n            if (typeof event.data !== \"object\") {\r\n                return;\r\n            }\r\n            //noinspection UnnecessaryLocalVariableJS\r\n            const {data:{action, requestId, value}, source, origin} = event;\r\n\r\n            if (action === responseAction && this.__responders.has(requestId)) {\r\n                this.__responders.get(requestId)(value);\r\n                this.__responders.delete(requestId);\r\n\r\n            } else if (this.__listeners.has(action)) {\r\n                let resp = this.__listeners.get(action)(value);\r\n                source.postMessage({action: responseAction, requestId, value: resp}, origin);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {String} action\r\n     * @param {*} value\r\n     * @return {Promise}\r\n     */\r\n    send(action, value = null) {\r\n        return this.sendEx(this.defaultWindow, this.defaultOrigin, action, value);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {Window} window\r\n     * @param {String} origin\r\n     * @param {String} action\r\n     * @param {*} value\r\n     * @return {Promise}\r\n     */\r\n    sendEx(window, origin, action, value = null) {\r\n        return new Promise(resolve => {\r\n            const requestId = nextRequestId++;\r\n            this.__responders.set(requestId, resolve);\r\n            window.postMessage({action, requestId, value}, origin);\r\n        });\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {String} action\r\n     * @param {function} callback\r\n     */\r\n    on(action, callback) {\r\n        this.__listeners.set(action, callback);\r\n    }\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/utils/message-rpc.js\n **/","export default class Cell {\r\n\r\n    constructor(value) {\r\n        this._value = value;\r\n        this._listeners = new Set();\r\n    }\r\n\r\n    get value() { return this._value; }\r\n\r\n    set value(v) {\r\n        this._value = v;\r\n        this.poke();\r\n    }\r\n\r\n    poke() {\r\n        this._listeners.forEach(l => l(this._value));\r\n    }\r\n\r\n    onValue(lst) {\r\n        this._listeners.add(lst);\r\n        lst(this.value);\r\n        return this;\r\n    }\r\n\r\n    unListen(lst) {\r\n        this._listeners.delete(lst);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * @param {function(Cell, *)} foo\r\n     * @param {*} [initial]\r\n     * @return {Cell}\r\n     */\r\n    derive(foo, initial) {\r\n        var c = new Cell(initial);\r\n        this.onValue(v => foo(c, v));\r\n        return c;\r\n    }\r\n\r\n    /**\r\n     * @param {Array.<Cell>} cells\r\n     * @return {Cell}\r\n     */\r\n    static combine(...cells) {\r\n        const cell = new Cell(cells.map(c => c.value));\r\n        cells.forEach((c, i) => c.onValue(v => {\r\n            let vv = cell.value;\r\n            vv[i] = v;\r\n            cell.value = vv;\r\n        }));\r\n        return cell;\r\n    }\r\n\r\n    map(foo) { return this.derive((c, v) => c.value = foo(v)); }\r\n\r\n    filter(foo) { return this.derive((c, v) => foo(v) && (c.value = v)); }\r\n\r\n    throttle(duration) {\r\n        let val = undefined,\r\n            timer = null;\r\n\r\n        return this.derive((c, v) => {\r\n            val = v;\r\n            if (!timer) {\r\n                timer = setTimeout(() => {\r\n                    if (val !== undefined) {\r\n                        c.value = this.value;\r\n                        val = undefined;\r\n                    }\r\n                    timer = null;\r\n                }, duration);\r\n            }\r\n        }, this.value);\r\n    }\r\n\r\n    /**\r\n     * For cell with Promise's values\r\n     * @param {*} [initial]\r\n     * @return {Cell}\r\n     */\r\n    latestPromise(initial) {\r\n        var lastProm = null;\r\n        return this.derive((c, v) => {\r\n            let prom = v;\r\n            lastProm = prom;\r\n            prom.then(res => {\r\n                if (prom === lastProm) {\r\n                    c.value = res;\r\n                }\r\n            });\r\n        }, initial);\r\n    }\r\n\r\n    distinct() {\r\n        var val;\r\n        return this.derive((c, v) => {\r\n            if (v !== val) {\r\n                val = v;\r\n                c.value = v;\r\n            }\r\n        });\r\n    }\r\n\r\n    static fromInput(input, eventNames, property) {\r\n        if (!input || !(input instanceof HTMLInputElement || input instanceof HTMLTextAreaElement || input instanceof HTMLSelectElement)) {\r\n            return new Cell(null);\r\n        }\r\n\r\n        var defaultProperty = \"value\";\r\n        if (input instanceof HTMLInputElement && (input.type === \"checkbox\" || input.type === \"radio\")) {\r\n            defaultProperty = \"checked\";\r\n        }\r\n\r\n        var events = eventNames ? eventNames.split(\" \") : [\"input\", \"change\"];\r\n        property = property || defaultProperty;\r\n\r\n        var getVal = () => (property === \"self\") ? input : input[property];\r\n\r\n        var cell = new Cell(getVal());\r\n        events.forEach(event => input.addEventListener(event, () => cell.value = getVal()));\r\n        return cell;\r\n    }\r\n\r\n    static ticker(timeout) {\r\n        let ticker = new Cell(true);\r\n        setInterval(() => ticker.value = true, timeout);\r\n        return ticker;\r\n    }\r\n\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/utils/cell.js\n **/"],"sourceRoot":""}